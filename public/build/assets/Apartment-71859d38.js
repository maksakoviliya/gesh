import{g as z,d as $,a as F,e as C,f as q,_ as H}from"./AppLayout-936be617.js";import{a as s,c as o,F as L,b as B,n as O,g as t,k as v,m as I,u as f,j as R,r as A,w as h,e as i,t as d,f as x,i as S}from"./app-ba3567cf.js";import{a as G}from"./Heading-ea83cea6.js";import{_ as W}from"./ButtonComponent-a65a289e.js";import{_ as Z}from"./Avatar-2ebde52a.js";import{u as N}from"./useToasts-3ee1331b.js";import{_ as J}from"./Map.vue_vue_type_script_setup_true_lang-06ae2f10.js";import"./index.esm.min-70ec0620.js";import"./index-62373370.js";const K={class:"rounded-xl grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 grid-rows-2 md:max-h-72 gap-1 overflow-hidden"},Q=["src"],X={__name:"Gallery",props:{images:{type:Array,default:[]}},setup(_){const e=_,p=g=>{let a=[];return g===0&&a.push("row-span-2",e.images.length<=1?"col-span-full":"col-span-2"),g===1&&a.push("row-span-2",e.images.length<=2?"col-span-2":""),a.join(" ")};return(g,a)=>(s(),o("div",K,[(s(!0),o(L,null,B(_.images,(y,b)=>(s(),o("div",{class:O(["group overflow-hidden",p(b)])},[t("img",{src:y.src,class:"object-cover w-full h-full transition cursor-pointer group-hover:scale-110",alt:""},null,8,Q)],2))),256))]))}};const tt={__name:"Datepicker",props:{start:{type:Date,required:!0},end:{type:Date,required:!0},disabledDates:{type:Array,default:()=>[]}},emits:["setDates","invalidSelect"],setup(_,{emit:e}){const p=_,g=v(()=>[p.start,p.end]),a=e,y=u=>{a("setDates",{start:u[0],end:u[1]})},{errorToast:b}=N(),w=u=>{a("invalidSelect",u),b("Выбранный диапазон дат недоступен.")},k=v(()=>localStorage.getItem("color-theme")==="dark"||document.documentElement.classList.contains("dark"));return(u,M)=>(s(),I(f(z),{"model-value":g.value,"onUpdate:modelValue":y,"no-disabled-range":"","multi-calendars":"",dark:k.value,onInvalidSelect:w,"partial-range":!1,"auto-apply":"","month-change-on-scroll":!1,"max-range":"30","disabled-dates":p.disabledDates,"disable-year-select":"","month-name-format":"long",locale:"ru",format:"dd.MM.yyyy",placeholder:"Выберите даты","min-date":new Date,"enable-time-picker":!1,"hide-navigation":["month","year","time"]},null,8,["model-value","dark","disabled-dates","min-date"]))}},et={key:0,class:"text-3xl font-semibold"},at={class:"flex flex-col items-start lg:flex-row gap-6 justify-between mt-6 relative"},st={class:"w-full lg:w-2/3"},nt=t("hr",{class:"my-4"},null,-1),lt={class:"flex justify-between gap-x-6"},rt={class:"flex min-w-0 gap-x-4"},ot={class:"min-w-0 flex-auto"},dt={class:"text-sm font-semibold leading-6 text-gray-900"},it={class:"mt-1 truncate text-xs leading-5 text-gray-500"},ct=t("div",{class:"hidden shrink-0 sm:flex sm:flex-col sm:items-end"},[t("p",{class:"text-sm leading-6 text-gray-900"},"Владелец"),t("p",{class:"mt-1 text-xs leading-5 text-gray-500"},[S(" На сайте "),t("time",{datetime:"2023-01-23T13:23Z"},"2 года")])],-1),mt=t("hr",{class:"my-4"},null,-1),ut={class:"grid grid-cols-2 md:grid-cols-3 gap-4"},_t=["innerHTML"],pt={class:"text-sm text-neutral-500"},gt={key:1,class:"mt-4 py-4 border-t"},ft={key:2,class:"mt-4 py-4 border-t"},ht={class:"relative lg:sticky rounded-lg shadow-lg border border-neutral-100 dark:border-slate-700 dark:shadow-gray-900 w-full lg:w-1/3 lg:top-28 p-6"},xt={class:"flex flex-wrap gap-2 xl:gap-4"},vt={class:"text-2xl md:text-3xl font-semibold flex items-center gap-2 dark:text-white"},yt={key:0,class:"flex flex-col"},bt=t("span",{class:"text-neutral-500 dark:text-slate-400 font-light text-sm leading-none whitespace-nowrap"},"ночь в",-1),wt=t("span",{class:"text-neutral-500 dark:text-slate-400 font-light text-sm leading-none"},"будни",-1),kt=[bt,wt],Dt={key:1},$t=t("span",{class:"text-neutral-500 dark:text-slate-400 font-light text-sm leading-none whitespace-nowrap"},"/ ночь",-1),St=[$t],jt={key:0,class:"text-2xl md:text-3xl font-semibold flex items-center gap-2"},Vt=t("div",{class:"flex flex-col"},[t("span",{class:"text-neutral-500 font-light text-sm leading-none whitespace-nowrap"},"ночь в"),t("span",{class:"text-neutral-500 font-light text-sm leading-none"},"выходные")],-1),Lt={class:"mt-4"},Tt={class:"flex flex-col gap-3 mt-4"},Bt=t("div",{class:"font-light text-sm text-center mt-3 text-neutral-500"},"Пока вы ни за что не платите",-1),Mt={class:"divide-y divide-gray-100 border-t mt-4"},Pt={class:"py-4 flex flex-col gap-2"},Ct={class:"flex w-full items-baseline justify-between"},qt={class:"font-light leading-6 text-gray-600"},At={class:"font-light leading-none text-gray-600 outline-none border-b border-gray-400 hover:border-gray-600 transition"},It={class:"divide-y divide-gray-100 max-h-52 overflow-auto"},Nt={class:"font-light text-sm leading-6 text-gray-600"},Yt={class:"mt-1 text-sm font-medium leading-6 text-neutral-600"},Et={class:"mt-1 font-medium leading-6 text-neutral-600"},Ut={class:"flex w-full items-baseline justify-between"},zt={class:"font-light leading-6"},Ft=t("div",{class:"font-light leading-none text-gray-600 outline-none border-b border-gray-400 hover:border-gray-600 transition"}," Сервисный сбор ",-1),Ht=t("div",{class:"max-h-52 p-4 text-neutral-600 leading-tight text-sm"},[S(" Благодаря этому сбору мы развиваем наш сервис и, в том числе, обеспечиваем путешественников круглосуточной поддержкой. "),t("br"),S(" Данный сервисный сбор удерживатеся при отмене без уважительных причин. ")],-1),Ot={class:"mt-1 font-medium leading-6 text-neutral-600"},Rt={class:"border-t pt-4 flex flex-col gap-2"},Gt={class:"flex w-full items-baseline justify-between"},Wt=t("dt",{class:"font-bold leading-6 text-neutral-800"},"Итого:",-1),Zt={class:"mt-1 font-bold leading-6 text-lg text-neutral-800"},re={__name:"Apartment",props:{apartment:Array|Object},setup(_){var P;const e=_,p=()=>{var l;return[(l=e.apartment.data.category)==null?void 0:l.title,e.apartment.data.title??null,e.apartment.data.city].filter(c=>!!c).join(", ")},g=()=>[`${e.apartment.data.guests} гостей`,`${e.apartment.data.bedrooms} спальня`,`${e.apartment.data.beds} кровать`,`${e.apartment.data.bathrooms} ванная`].filter(l=>!!l).join(" · "),a=R({start:new Date,end:new Date(new Date().setDate(new Date().getDate()+2)),range:2,guests:2,children:0}),y=v(()=>{let n=null;return(a.range<=1||a.range===21)&&(n=`${a.range} ночь`),(a.range>1&&a.range<=5||a.range>21&&a.range<=24)&&(n=`${a.range} ночи`),(a.range>5&&a.range<=20||a.range>24)&&(n=`${a.range} ночей`),`${n}`}),b=n=>{const l=$(n.start),c=$(n.end);a.start=l.set("hours",0).set("minutes",0).toDate(),a.end=c.set("hours",0).set("minutes",0).toDate(),a.range=c.diff(l,"day")},w=A([]),k=v(()=>{var D;const n=$(a.start),l=$(a.end);w.value=[];let c=0;for(let m=n;m.isBefore(l);m=m.add(1,"day")){const j=m.day()===5||m.day()===6?e.apartment.data.weekends_price:e.apartment.data.weekdays_price,r=((D=e.apartment.data.dates.find(V=>$(V.date).isSame(m)))==null?void 0:D.price)??j;w.value.push({date:m.format("DD.MM.YYYY"),price:r}),c+=r}return c}),u=v(()=>Math.ceil(k.value*.15)),M=v(()=>k.value+u.value),{errorToast:Y}=N(),E=()=>a.post(route("reservation-requests.store",{apartment:e.apartment.data.id}),{onError:n=>{Y(Object.values(n)[0])}}),U=A([{center:[e.apartment.data.lat,e.apartment.data.lon],img:(P=e.apartment.data.media[0])==null?void 0:P.src}]);return(n,l)=>(s(),I(F,null,{default:h(()=>[i(H,null,{default:h(()=>{var c,D,m,j,T;return[e.apartment.data.address?(s(),o("div",et,d(e.apartment.data.address),1)):x("",!0),i(X,{class:"mt-6",images:_.apartment.data.media},null,8,["images"]),t("div",at,[t("div",st,[i(G,{title:p(),subtitle:g()},null,8,["title","subtitle"]),nt,t("div",lt,[t("div",rt,[i(Z,{src:e.apartment.data.owner.avatar,class:"h-12 w-12 flex-none rounded-full bg-gray-50"},null,8,["src"]),t("div",ot,[t("p",dt," Хозяин: "+d(e.apartment.data.owner.name),1),t("p",it,d(e.apartment.data.owner.email),1)])]),ct]),e.apartment.data.features.length?(s(),o(L,{key:0},[mt,t("div",ut,[(s(!0),o(L,null,B(e.apartment.data.features,r=>(s(),o("div",{key:r.id,class:"flex items-center gap-3"},[t("div",{class:"text-neutral-800",innerHTML:r.icon},null,8,_t),t("div",pt,d(r.title),1)]))),128))])],64)):x("",!0),e.apartment.data.description?(s(),o("div",gt,d(e.apartment.data.description),1)):x("",!0),e.apartment.data.lon&&e.apartment.data.lat?(s(),o("div",ft,[i(J,{lon:e.apartment.data.lon,lat:e.apartment.data.lat,"is-input":!1,markers:U.value},null,8,["lon","lat","markers"])])):x("",!0)]),t("div",ht,[t("div",xt,[t("div",vt,[S(d((c=e.apartment.data.weekdays_price)==null?void 0:c.toLocaleString())+"₽ ",1),e.apartment.data.weekdays_price!==e.apartment.data.weekends_price?(s(),o("div",yt,kt)):(s(),o("div",Dt,St))]),e.apartment.data.weekdays_price!==e.apartment.data.weekends_price?(s(),o("div",jt,[S(d((D=e.apartment.data.weekends_price)==null?void 0:D.toLocaleString())+"₽ ",1),Vt])):x("",!0)]),t("div",Lt,[i(tt,{range:"",start:f(a).start,end:f(a).end,"disabled-dates":e.apartment.data.all_disabled_dates??[],onSetDates:b},null,8,["start","end","disabled-dates"]),i(C,{modelValue:f(a).guests,"onUpdate:modelValue":l[0]||(l[0]=r=>f(a).guests=r),class:"mt-4",title:"Гости",subtitle:"Укажите количество гостей"},null,8,["modelValue"]),i(C,{modelValue:f(a).children,"onUpdate:modelValue":l[1]||(l[1]=r=>f(a).children=r),class:"mt-4",title:"Дети",subtitle:"0-12 лет"},null,8,["modelValue"])]),t("div",Tt,[(e.apartment.data.fast_reserve,x("",!0)),i(W,{outline:!0,onClick:E,label:"Продолжить"})]),Bt,t("dl",Mt,[t("div",Pt,[t("div",Ct,[t("dt",qt,[i(q,null,{toggle:h(()=>[t("div",At,d(y.value),1)]),content:h(()=>[t("dl",It,[(s(!0),o(L,null,B(w.value,r=>{var V;return s(),o("div",{class:"py-1 px-4 flex w-full items-baseline justify-between",key:r.date},[t("dt",Nt,d(r.date),1),t("dd",Yt,d((V=r.price)==null?void 0:V.toLocaleString())+"₽ ",1)])}),128))])]),_:1})]),t("dd",Et,d((m=k.value)==null?void 0:m.toLocaleString())+"₽ ",1)]),t("div",Ut,[t("dt",zt,[i(q,null,{toggle:h(()=>[Ft]),content:h(()=>[Ht]),_:1})]),t("dd",Ot,d((j=u.value)==null?void 0:j.toLocaleString())+"₽ ",1)])])]),t("div",Rt,[t("div",Gt,[Wt,t("dd",Zt,d((T=M.value)==null?void 0:T.toLocaleString())+"₽ ",1)])])])])]}),_:1})]),_:1}))}};export{re as default};
