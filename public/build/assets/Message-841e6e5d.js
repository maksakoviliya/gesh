import{_ as b}from"./ButtonComponent-b1b7d6fc.js";import{c as O,b as V}from"./AppLayout-fff70dd6.js";import{_ as B}from"./Input-72b384ce.js";import{r as y,a as N,o as r,j as u,i as t,t as a,n as j,k as g,m as v,F as q,g as m,f as M,w as C,u as w,O as A}from"./app-8e33f2c1.js";import{u as E}from"./useToasts-441cb35c.js";const F=t("div",{class:"font-semibold text-neutral-800"},"Запрос на бронирование",-1),z={class:"font-light text-xs text-gray-400"},D={class:"font-light text-neutral-800"},L={class:"text-neutral-400 text-sm"},U={class:"font-light text-neutral-800"},G={key:0},H={key:0},I={class:"flex justify-end gap-2"},J={key:1,class:"font-light text-neutral-800"},K={class:"divide-y divide-gray-100"},P={class:"py-2 flex w-full items-baseline justify-between"},Q=t("dt",{class:"font-light leading-6 text-пкфн-600"},[t("div",null,"Даты:")],-1),W={class:"mt-1 font-medium leading-6 text-neutral-600"},X={class:"text-neutral-400 text-sm"},Y={class:"py-2 flex w-full items-baseline justify-between"},Z=t("dt",{class:"font-light leading-6 text-пкфн-600"},[t("div",null,"Взрослые:")],-1),ee={class:"mt-1 font-medium leading-6 text-neutral-600"},te={key:0,class:"py-2 flex w-full items-baseline justify-between"},se=t("dt",{class:"font-light leading-6 text-пкфн-600"},[t("div",null,"Дети:")],-1),ae={class:"mt-1 font-medium leading-6 text-neutral-600"},oe={class:"py-2 flex w-full items-baseline justify-between"},le=t("dt",{class:"font-light leading-6 text-пкфн-600"},[t("div",null,"Стоимость:")],-1),ne={class:"mt-1 font-medium leading-6 text-neutral-600"},ge={__name:"ReservationRequest",props:{item:{required:!0},compact:{type:Boolean,default:!1},isOwner:{type:Boolean,default:!1}},setup(h){const n=h,e=y(n.item),_=y(!1),d=y(!1),c=N({status_text:""}),{infoToast:f,successToast:p,errorToast:x}=E(),S=()=>{axios.post(route("account.reservation-requests.reject",{reservationRequest:e.value.id}),{status_text:c.status_text}).then(o=>{var s,l;_.value=!1,e.value.status=(s=o.data)==null?void 0:s.status,e.value.status_text=(l=o.data)==null?void 0:l.status_text,f("Отказано в запросе на бронирование.")}).catch(o=>{var s,l,i,$,k;((s=o.response)==null?void 0:s.status)===422&&(console.log("error.response?.data?.message",(i=(l=o.response)==null?void 0:l.data)==null?void 0:i.message),c.setError("status_text",((k=($=o.response)==null?void 0:$.data)==null?void 0:k.message)??"Что-то пошло не так."))})},R=()=>{axios.post(route("account.reservation-requests.submit",{reservationRequest:e.value.id})).then(o=>{var s,l;d.value=!1,e.value.status=(s=o.data)==null?void 0:s.status,e.value.reservation_id=(l=o.data)==null?void 0:l.reservation_id,p("Создано новое бронирование. Ожмдайте оплату.")}).catch(o=>{x("Что-то пошло не так.")})},T=()=>{var o,s;if((o=e.value.reservation)!=null&&o.id){const l=n.isOwner?"account.reservations.owner.view":"account.reservations.view";A.visit(route(l,{reservation:(s=e.value.reservation)==null?void 0:s.id}))}};return(o,s)=>{var l;return r(),u("div",{class:j(["border border-gray-300 rounded-lg p-3",[e.value.status==="rejected"?"opacity-40":"",e.value.status==="submitted"?"border-teal-600":""]])},[t("div",{class:j(["flex items-baseline justify-between",n.compact?"flex-col-reverse gap-0":"gap-4"])},[F,t("div",z,a(e.value.created_at),1)],2),t("div",D,[g(" с "+a(e.value.start)+" по "+a(e.value.end)+" | ",1),t("span",L,"ночи: "+a(e.value.range),1)]),t("div",U,[g(" Взрослые: "+a(e.value.guests)+" ",1),e.value.children>0?(r(),u("span",G," | Дети: "+a(e.value.children),1)):v("",!0)]),n.compact?v("",!0):(r(),u("div",H,[t("div",I,[n.isOwner?(r(),u(q,{key:0},[e.value.status?v("",!0):(r(),u(q,{key:0},[m(b,{label:"Отказать",onClick:s[0]||(s[0]=i=>_.value=!0),small:!0,outline:!0,"auto-width":!0,class:"px-3"}),m(b,{label:"Подтвердить",onClick:s[1]||(s[1]=i=>d.value=!0),small:!0,"bg-class":"bg-green-50","text-class":"text-green-800","border-class":"border-green-800","auto-width":!0,class:"px-3"})],64))],64)):v("",!0),e.value.status==="submitted"&&((l=e.value.reservation)!=null&&l.id)?(r(),M(b,{key:1,label:"К бронированию",small:!0,outline:!0,"auto-width":!0,onClick:T,class:"px-3"})):v("",!0)])])),e.value.status==="rejected"?(r(),u("div",J,a(`Отказано${e.value.status_text?": "+e.value.status_text:""}`),1)):v("",!0),m(O,{"is-open":_.value,onOnSecondaryAction:s[3]||(s[3]=i=>_.value=!1),onOnClose:s[4]||(s[4]=i=>_.value=!1),onOnSubmit:S,title:"Отказать в запросе на бронирование","action-label":"Отказать","secondary-action-label":"Отменить"},{body:C(()=>[m(B,{modelValue:w(c).status_text,"onUpdate:modelValue":s[2]||(s[2]=i=>w(c).status_text=i),id:"reason",name:"reason",error:w(c).errors.status_text,label:"Укажите причину отказа (можно не указывать)"},null,8,["modelValue","error"])]),_:1},8,["is-open"]),m(O,{"is-open":d.value,onOnSecondaryAction:s[5]||(s[5]=i=>d.value=!1),onOnClose:s[6]||(s[6]=i=>d.value=!1),onOnSubmit:R,title:"Подтвердить запрос на бронирование","action-label":"Подтвердить","secondary-action-label":"Отменить"},{body:C(()=>[t("dl",K,[t("div",P,[Q,t("dd",W,[g(" с "+a(e.value.start)+" по "+a(e.value.end)+" | ",1),t("span",X,"ночи: "+a(e.value.range),1)])]),t("div",Y,[Z,t("dd",ee,a(e.value.guests),1)]),e.value.children>0?(r(),u("div",te,[se,t("dd",ae,a(e.value.children),1)])):v("",!0),t("div",oe,[le,t("dd",ne,a(e.value.price.toLocaleString())+"₽ ",1)])])]),_:1},8,["is-open"])],2)}}},ie={class:"flex items-start gap-2"},re={class:"flex flex-col"},ue={class:"text-sm font-bold"},de={key:0,class:"text-neutral-600"},ce={class:"font-light text-xs text-gray-400"},ve={class:""},he={__name:"Message",props:{item:{type:Object,required:!0}},setup(h){const n=h;return(e,_)=>{var d,c,f,p,x;return r(),u("div",ie,[m(V,{src:(d=n.item.user)==null?void 0:d.avatar},null,8,["src"]),t("div",re,[t("div",ue,[((f=(c=e.$page.props.user)==null?void 0:c.data)==null?void 0:f.id)===((p=n.item.user)==null?void 0:p.id)?(r(),u("span",de,"Вы:")):v("",!0),g(" "+a((x=n.item.user)==null?void 0:x.name)+" ",1),t("span",ce,a(n.item.created_at),1)]),t("div",ve,a(n.item.message),1)])])}}};export{ge as _,he as a};
