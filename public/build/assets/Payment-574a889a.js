import{d as b,c as G,e as J,g as V,_ as K}from"./AppLayout-415c3770.js";import{_ as Q}from"./Heading-187c4d07.js";import{d as W,h as X,r as $,q as f,o as Z,l as j,w as d,a as v,e as h,g as t,t as a,c as k,f as L,u as P,i as _,z as tt,b as et,F as st,O as at}from"./app-ba0b5d1d.js";import{_ as it}from"./ButtonComponent-09c15ff3.js";import{_ as ot}from"./Breadcrumbs-5330fc82.js";import"./index.esm.min-8fdce670.js";import"./index-4c8f8940.js";import"./Input-f71ed4d7.js";import"./index-9ef572b0.js";import"./Avatar-96976c82.js";import"./index-e5c5aa4a.js";import"./useToasts-fda62083.js";/*! vue-countdown v2.1.2 | (c) 2018-present Chen Fengyuan | MIT */const w=1e3,S=60*w,E=60*S,H=24*E,O="abort",B="end",A="progress",F="start",q="visibilitychange";var nt=W({name:"VueCountdown",props:{autoStart:{type:Boolean,default:!0},emitEvents:{type:Boolean,default:!0},interval:{type:Number,default:1e3,validator:i=>i>=0},now:{type:Function,default:()=>Date.now()},tag:{type:String,default:"span"},time:{type:Number,default:0,validator:i=>i>=0},transform:{type:Function,default:i=>i}},emits:[O,B,A,F],data(){return{counting:!1,endTime:0,totalMilliseconds:0,requestId:0}},computed:{days(){return Math.floor(this.totalMilliseconds/H)},hours(){return Math.floor(this.totalMilliseconds%H/E)},minutes(){return Math.floor(this.totalMilliseconds%E/S)},seconds(){return Math.floor(this.totalMilliseconds%S/w)},milliseconds(){return Math.floor(this.totalMilliseconds%w)},totalDays(){return this.days},totalHours(){return Math.floor(this.totalMilliseconds/E)},totalMinutes(){return Math.floor(this.totalMilliseconds/S)},totalSeconds(){return Math.floor(this.totalMilliseconds/w)}},watch:{$props:{deep:!0,immediate:!0,handler(){this.totalMilliseconds=this.time,this.endTime=this.now()+this.time,this.autoStart&&this.start()}}},mounted(){document.addEventListener(q,this.handleVisibilityChange)},beforeUnmount(){document.removeEventListener(q,this.handleVisibilityChange),this.pause()},methods:{start(){this.counting||(this.counting=!0,this.autoStart||(this.totalMilliseconds=this.time,this.endTime=this.now()+this.time),this.emitEvents&&this.$emit(F),document.visibilityState==="visible"&&this.continue())},continue(){if(!this.counting)return;const i=Math.min(this.totalMilliseconds,this.interval);if(i>0){let e,r;const c=u=>{e||(e=u),r||(r=u);const y=u-e;y>=i||y+(u-r)/2>=i?this.progress():this.requestId=requestAnimationFrame(c),r=u};this.requestId=requestAnimationFrame(c)}else this.end()},pause(){cancelAnimationFrame(this.requestId)},progress(){this.counting&&(this.update(),this.emitEvents&&this.totalMilliseconds>0&&this.$emit(A,{days:this.days,hours:this.hours,minutes:this.minutes,seconds:this.seconds,milliseconds:this.milliseconds,totalDays:this.totalDays,totalHours:this.totalHours,totalMinutes:this.totalMinutes,totalSeconds:this.totalSeconds,totalMilliseconds:this.totalMilliseconds}),this.continue())},abort(){this.counting&&(this.pause(),this.counting=!1,this.emitEvents&&this.$emit(O))},end(){this.counting&&(this.pause(),this.totalMilliseconds=0,this.counting=!1,this.emitEvents&&this.$emit(B))},update(){this.counting&&(this.totalMilliseconds=Math.max(0,this.endTime-this.now()))},restart(){this.pause(),this.totalMilliseconds=this.time,this.endTime=this.now()+this.time,this.counting=!1,this.start()},handleVisibilityChange(){switch(document.visibilityState){case"visible":this.update(),this.continue();break;case"hidden":this.pause();break}}},render(){return X(this.tag,this.$slots.default?[this.$slots.default(this.transform({days:this.days,hours:this.hours,minutes:this.minutes,seconds:this.seconds,milliseconds:this.milliseconds,totalDays:this.totalDays,totalHours:this.totalHours,totalMinutes:this.totalMinutes,totalSeconds:this.totalSeconds,totalMilliseconds:this.totalMilliseconds}))]:void 0)}});const rt={class:"relative flex-col md:flex-row flex items-start gap-4 mt-6"},lt={class:"md:w-1/2 lg:w-2/3"},dt=t("div",{class:"font-semibold text-xl mt-4 pt-2 border-t border-gray-100 dark:text-slate-200 dark:border-slate-500"}," Ваша поездка: ",-1),ct={class:"mt-3"},ut=t("div",{class:"text-sm font-medium dark:text-slate-400"},"Даты:",-1),ht={class:"dark:text-slate-200 font-medium"},mt={class:"mt-3"},ft=t("div",{class:"text-sm font-medium dark:text-slate-400"},"Гости:",-1),vt={class:"dark:text-slate-200 font-medium"},_t={key:0,class:"font-medium dark:text-slate-200"},gt=t("div",{class:"font-semibold text-xl mt-4 pt-2 border-t border-gray-100 dark:text-slate-200 dark:border-slate-500"}," Оплата: ",-1),pt={class:"flex items-baseline gap-5"},xt=t("div",{class:"font-light text-sm text-neutral-800 leading-tight mt-4 dark:text-slate-400"},[_(" Сейчас вам необходимо оплатить только 30% от общей суммы, чтобы забронировать жилье. Оставшуюся сумму вы сможете перевести хозяину при заселении. "),t("br"),_("Таким образом, вы можете забронировать жилье заранее и не переживать о полной оплате до момента заселения. "),t("br"),_(" Оплата оставшейся суммы при заселении гарантирует вам получение жилья и удобство в расчетах. ")],-1),bt={class:"md:sticky w-full md:w-1/2 lg:w-1/3 rounded-lg shadow-lg border border-neutral-100 top-28 p-6"},yt={class:"flex items-stretch justify-start gap-4"},Mt=["src"],kt={class:"flex flex-col justify-between"},wt={class:"text-gray-600 font-light dark:text-slate-300"},St=["innerHTML"],Et=t("div",{class:"font-semibold text-xl mt-4 pt-2 border-t border-gray-100 dark:border-slate-600 dark:text-slate-200"}," Детализация цены: ",-1),Dt={class:"divide-y divide-gray-100 dark:divide-slate-600"},Tt={class:"py-2 flex w-full items-baseline justify-between"},$t=t("dt",{class:"font-light leading-6 text-gray-600 dark:text-slate-300"},[t("div",null,"Гости:")],-1),Lt={class:"mt-1 font-medium leading-6 text-neutral-600 dark:text-slate-200"},Nt={key:0,class:"py-2 flex w-full items-baseline justify-between"},Yt=t("dt",{class:"font-light leading-6 text-gray-600 dark:text-slate-300"},[t("div",null,"Дети:")],-1),It={class:"mt-1 font-medium leading-6 text-neutral-600 dark:text-slate-200"},Ct={class:"py-4 flex flex-col gap-2"},Vt={class:"flex w-full items-baseline justify-between"},jt={class:"font-light leading-6 text-gray-600"},Pt={class:"font-light leading-none text-gray-600 dark:text-slate-300 outline-none border-b border-gray-400 dark:border-slate-300 hover:border-gray-600 transition"},Ht={class:"divide-y divide-gray-100 dark:divide-slate-600 max-h-52 overflow-auto"},Ot={class:"font-light text-sm leading-6 text-gray-600 dark:text-slate-300"},Bt={class:"mt-1 text-sm font-medium leading-6 text-neutral-600 dark:text-slate-200"},At={class:"mt-1 font-medium leading-6 text-neutral-600 dark:text-slate-200"},Ft={class:"flex w-full items-baseline justify-between"},qt={class:"font-light leading-6"},Rt=t("div",{class:"font-light leading-none text-gray-600 dark:text-slate-300 outline-none border-b border-gray-400 dark:border-slate-300 hover:border-gray-600 transition"}," Сервисный сбор ",-1),Ut=t("div",{class:"max-h-52 p-4 text-neutral-600 leading-tight text-sm dark:text-slate-400"},[_(" Благодаря этому сбору мы развиваем наш сервис и, в том числе, обеспечиваем путешественников круглосуточной поддержкой. "),t("br"),_(" Данный сервисный сбор удерживатеся при отмене без уважительных причин. ")],-1),zt={class:"mt-1 font-medium leading-6 text-neutral-600 dark:text-slate-200"},Gt={class:"pt-4 flex w-full items-baseline justify-between"},Jt=t("dt",{class:"font-bold leading-6 text-neutral-800 dark:text-slate-200"},[t("div",null,"Итого:")],-1),Kt={class:"mt-1 font-bold leading-6 text-neutral-800 dark:text-slate-200"},le={__name:"Payment",props:{reservation:{type:Object}},setup(i){var I,C;const e=i,r=$([]),c=f(()=>{var p;b.extend(G);const s=b(e.reservation.data.start,"DD.MM.YYYY"),m=b(e.reservation.data.end,"DD.MM.YYYY");r.value=[];let g=0;for(let o=s;o.isBefore(m);o=o.add(1,"day")){const M=o.day()===5||o.day()===6?e.reservation.data.apartment.weekends_price:e.reservation.data.apartment.weekdays_price,x=((p=e.reservation.data.apartment.dates.find(n=>b(n.date).isSame(o)))==null?void 0:p.price)??M;r.value.push({date:o.format("DD.MM.YYYY"),price:x}),g+=x}return g}),u=f(()=>{let s=null;return(e.reservation.data.range<=1||e.reservation.data.range===21)&&(s=`${e.reservation.data.range} ночь`),(e.reservation.data.range>1&&e.reservation.data.range<=5||e.reservation.data.range>21&&e.reservation.data.range<=24)&&(s=`${e.reservation.data.range} ночи`),(e.reservation.data.range>5&&e.reservation.data.range<=20||e.reservation.data.range>24)&&(s=`${e.reservation.data.range} ночей`),`${s}`}),y=f(()=>[`${e.reservation.data.apartment.guests}&nbsp;гостей`,`${e.reservation.data.apartment.bedrooms}&nbsp;спальня`,`${e.reservation.data.apartment.beds}&nbsp;кровать`,`${e.reservation.data.apartment.bathrooms}&nbsp;ванная`].filter(m=>!!m).join(" · ")),R=()=>{at.visit(route("account.reservations.pay",{reservation:e.reservation.data.id}))},U=$([{id:"account",route:route("account.index"),label:"Аккаунт"},{id:"reservations",route:route("account.reservations.list"),label:"Мои бронирования"},{id:"reservation",route:route("account.reservations.view",{reservation:(I=e.reservation.data)==null?void 0:I.id}),label:"Бронирование"},{id:"reservation.pay",route:route("account.reservations.view",{reservation:(C=e.reservation.data)==null?void 0:C.id}),label:"Оплата"}]),N=f(()=>{const s=(c.value>=1e5,.15);return Math.ceil(c.value*s)}),Y=f(()=>c.value+N.value),z=f(()=>Math.ceil(Y.value*.3)),D=$(0);return Z(()=>{const s=b(e.reservation.data.created_at,"DD.MM.YYYY HH:mm").toDate(),m=new Date;s.setTime(s.getTime()+5*60*60*1e3),D.value=s.getTime()-m.getTime()}),(s,m)=>(v(),j(J,null,{default:d(()=>[h(K,null,{default:d(()=>{var g,p,o,M,T,x;return[h(ot,{routes:U.value},null,8,["routes"]),t("div",rt,[t("div",lt,[h(Q,{title:"Оплата бронирования",subtitle:"Вы должны оплатить не позднее чем через пять часов, иначе бронирование отменится."}),t("div",null,[dt,t("div",ct,[ut,t("div",ht,a(e.reservation.data.start)+" - "+a(e.reservation.data.end),1)]),t("div",mt,[ft,t("div",vt,a(e.reservation.data.guests)+" гостя",1),e.reservation.data.children?(v(),k("div",_t,a(e.reservation.data.children)+" детей ",1)):L("",!0)])]),t("div",null,[gt,t("div",pt,[h(it,{class:"mt-3 px-16","auto-width":!0,label:`Перейти к оплате: ${z.value.toLocaleString()}₽`,onClick:R},null,8,["label"]),D.value?(v(),j(P(nt),{key:0,class:"text-neutral-800 dark:text-slate-400 font-medium text-lg",time:D.value},{default:d(({hours:n,minutes:l})=>[_(" Осталось "+a(n)+" ч. "+a(l)+" мин. ",1)]),_:1},8,["time"])):L("",!0)]),xt])]),t("div",bt,[t("div",yt,[h(P(tt),{href:s.route("apartment",{apartment:(g=e.reservation.data.apartment)==null?void 0:g.id}),class:"h-24 w-32 rounded-lg overflow-hidden"},{default:d(()=>{var n,l;return[t("img",{src:(l=(n=e.reservation.data.apartment)==null?void 0:n.media[0])==null?void 0:l.src,class:"h-full w-full object-cover",alt:""},null,8,Mt)]}),_:1},8,["href"]),t("div",kt,[t("div",wt,a((M=(o=(p=e.reservation.data)==null?void 0:p.apartment)==null?void 0:o.category)==null?void 0:M.title),1),t("div",{class:"font-light text-xs text-gray-600 mt-1 dark:text-slate-300",innerHTML:y.value},null,8,St)])]),Et,t("dl",Dt,[t("div",Tt,[$t,t("dd",Lt,a(e.reservation.data.guests),1)]),e.reservation.data.children>0?(v(),k("div",Nt,[Yt,t("dd",It,a(e.reservation.data.children),1)])):L("",!0),t("div",Ct,[t("div",Vt,[t("dt",jt,[h(V,null,{toggle:d(()=>[t("div",Pt,a(u.value),1)]),content:d(()=>[t("dl",Ht,[(v(!0),k(st,null,et(r.value,n=>{var l;return v(),k("div",{class:"py-1 px-4 flex w-full items-baseline justify-between",key:n.date},[t("dt",Ot,a(n.date),1),t("dd",Bt,a((l=n.price)==null?void 0:l.toLocaleString())+"₽ ",1)])}),128))])]),_:1})]),t("dd",At,a((T=c.value)==null?void 0:T.toLocaleString())+"₽ ",1)]),t("div",Ft,[t("dt",qt,[h(V,null,{toggle:d(()=>[Rt]),content:d(()=>[Ut]),_:1})]),t("dd",zt,a((x=N.value)==null?void 0:x.toLocaleString())+"₽ ",1)])]),t("div",Gt,[Jt,t("dd",Kt,a(Y.value.toLocaleString())+"₽ ",1)])])])])]}),_:1})]),_:1}))}};export{le as default};
