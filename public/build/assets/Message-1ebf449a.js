import{_ as y}from"./ButtonComponent-097dacef.js";import{_ as q}from"./index-ce3946ae.js";import{_ as N}from"./Input-301f4cf0.js";import{r as w,p as P,q as k,a as r,c as u,g as t,t as a,n as C,i as f,f as v,F as R,e as m,l as A,w as T,u as $,O as E}from"./app-c8d4ef52.js";import{u as F}from"./useToasts-f0a44f77.js";import{_ as z}from"./Avatar-0c1612b6.js";const D=t("div",{class:"font-semibold text-neutral-800 dark:text-slate-200"},"Запрос на бронирование",-1),U={class:"font-light text-xs text-gray-400"},G={class:"font-light text-neutral-800 dark:text-white"},H={class:"text-neutral-400 text-sm"},I={class:"font-light text-neutral-800 dark:text-slate-200"},J={key:0},K={class:"flex items-center gap-2 flex-wrap"},Q={class:"font-light text-neutral-800 dark:text-slate-200"},W={class:"font-light text-neutral-800 dark:text-slate-200"},X={key:0,class:"flex justify-end gap-2 mt-3"},Y={key:1,class:"font-light text-neutral-800"},Z=t("div",{class:"text-neutral-400 text-sm mt-1"},"Если укажете - то гость будет видеть причину отказа.",-1),ee={class:"divide-y divide-gray-100"},te={class:"py-2 flex w-full items-baseline justify-between"},se=t("dt",{class:"font-light leading-6 text-пкфн-600"},[t("div",null,"Даты:")],-1),ae={class:"mt-1 font-medium leading-6 text-neutral-600"},le={class:"text-neutral-400 text-sm"},oe={class:"py-2 flex w-full items-baseline justify-between"},ne=t("dt",{class:"font-light leading-6 text-пкфн-600"},[t("div",null,"Взрослые:")],-1),ie={class:"mt-1 font-medium leading-6 text-neutral-600"},re={key:0,class:"py-2 flex w-full items-baseline justify-between"},ue=t("dt",{class:"font-light leading-6 text-пкфн-600"},[t("div",null,"Дети:")],-1),de={class:"mt-1 font-medium leading-6 text-neutral-600"},ce={class:"py-2 flex w-full items-baseline justify-between"},ve={class:"font-light leading-6 text-пкфн-600"},_e={class:"mt-1 font-medium leading-6 text-neutral-600"},me={class:"py-2 flex w-full items-baseline justify-between"},fe=t("dt",{class:"font-light leading-6 text-пкфн-600"},[t("div",null,"Первоначальный платеж:")],-1),xe={class:"mt-1 font-medium leading-6 text-neutral-600"},Ce={__name:"ReservationRequest",props:{item:{required:!0},compact:{type:Boolean,default:!1},isOwner:{type:Boolean,default:!1}},setup(h){const n=h,e=w(n.item),_=w(!1),d=w(!1),c=P({status_text:""}),{infoToast:x,successToast:p,errorToast:g}=F(),V=()=>{axios.post(route("account.reservation-requests.reject",{reservationRequest:e.value.id}),{status_text:c.status_text}).then(l=>{var s,o;_.value=!1,e.value.status=(s=l.data)==null?void 0:s.status,e.value.status_text=(o=l.data)==null?void 0:o.status_text,x("Отказано в запросе на бронирование.")}).catch(l=>{var s,o,i,j,S;((s=l.response)==null?void 0:s.status)===422&&(console.log("error.response?.data?.message",(i=(o=l.response)==null?void 0:o.data)==null?void 0:i.message),c.setError("status_text",((S=(j=l.response)==null?void 0:j.data)==null?void 0:S.message)??"Что-то пошло не так."))})},B=()=>{axios.post(route("account.reservation-requests.submit",{reservationRequest:e.value.id})).then(l=>{var s,o;d.value=!1,e.value.status=(s=l.data)==null?void 0:s.status,e.value.reservation_id=(o=l.data)==null?void 0:o.reservation_id,p("Создано новое бронирование. Ожидайте оплату.")}).catch(l=>{g("Что-то пошло не так.")})},M=()=>{var l,s;if((l=e.value.reservation)!=null&&l.id){const o=n.isOwner?"account.reservations.owner.view":"account.reservations.view";E.visit(route(o,{reservation:(s=e.value.reservation)==null?void 0:s.id}))}},L=k(()=>{const l=(e.value.price>=1e5,.15);return Math.ceil(e.value.price*l)}),b=k(()=>e.value.price+L.value),O=k(()=>Math.ceil(b.value*.3));return(l,s)=>{var o;return r(),u("div",{class:C(["border border-gray-300 dark:border-slate-700 rounded-lg p-3",[e.value.status==="rejected"?"opacity-40":"",e.value.status==="submitted"?"border-teal-600":""]])},[t("div",{class:C(["flex items-baseline justify-between",n.compact?"flex-col-reverse gap-0":"gap-4"])},[D,t("div",U,a(e.value.created_at),1)],2),t("div",G,[f(" с "+a(e.value.start)+" по "+a(e.value.end)+" | ",1),t("span",H,"ночи: "+a(e.value.range),1)]),t("div",I,[f(" Взрослые: "+a(e.value.guests)+" ",1),e.value.children>0?(r(),u("span",J," | Дети: "+a(e.value.children),1)):v("",!0)]),t("div",K,[t("div",Q,"Цена: "+a(b.value.toLocaleString())+"₽",1),f(" | "),t("div",W," Первоначальный платеж: "+a(O.value.toLocaleString())+"₽ ",1)]),n.compact?v("",!0):(r(),u("div",X,[n.isOwner?(r(),u(R,{key:0},[e.value.status==="pending"?(r(),u(R,{key:0},[m(y,{label:"Отказать",onClick:s[0]||(s[0]=i=>_.value=!0),small:!0,outline:!0,"auto-width":!0,class:"px-3"}),m(y,{label:"Подтвердить",onClick:s[1]||(s[1]=i=>d.value=!0),small:!0,"bg-class":"bg-green-50","text-class":"text-green-800","border-class":"border-green-800","auto-width":!0,class:"px-3"})],64)):v("",!0)],64)):v("",!0),e.value.status==="submitted"&&((o=e.value.reservation)!=null&&o.id)?(r(),A(y,{key:1,label:"К бронированию",small:!0,outline:!0,"auto-width":!0,onClick:M,class:"px-3"})):v("",!0)])),e.value.status==="rejected"?(r(),u("div",Y,a(`Отказано${e.value.status_text?": "+e.value.status_text:""}`),1)):v("",!0),m(q,{"is-open":_.value,onOnSecondaryAction:s[3]||(s[3]=i=>_.value=!1),onOnClose:s[4]||(s[4]=i=>_.value=!1),onOnSubmit:V,title:"Отказать в запросе на бронирование","action-label":"Отказать","secondary-action-label":"Отменить"},{body:T(()=>[m(N,{modelValue:$(c).status_text,"onUpdate:modelValue":s[2]||(s[2]=i=>$(c).status_text=i),id:"reason",name:"reason",error:$(c).errors.status_text,label:"Укажите причину отказа (можно не указывать)"},null,8,["modelValue","error"]),Z]),_:1},8,["is-open"]),m(q,{"is-open":d.value,onOnSecondaryAction:s[5]||(s[5]=i=>d.value=!1),onOnClose:s[6]||(s[6]=i=>d.value=!1),onOnSubmit:B,title:"Подтвердить запрос на бронирование","action-label":"Подтвердить","secondary-action-label":"Отменить"},{body:T(()=>[t("dl",ee,[t("div",te,[se,t("dd",ae,[f(" с "+a(e.value.start)+" по "+a(e.value.end)+" | ",1),t("span",le,"ночи: "+a(e.value.range),1)])]),t("div",oe,[ne,t("dd",ie,a(e.value.guests),1)]),e.value.children>0?(r(),u("div",re,[ue,t("dd",de,a(e.value.children),1)])):v("",!0),t("div",ce,[t("dt",ve,[t("div",null,a(e.value.range)+" ночи:",1)]),t("dd",_e,a(b.value.toLocaleString())+"₽",1)]),t("div",me,[fe,t("dd",xe,a(O.value.toLocaleString())+"₽ ",1)])])]),_:1},8,["is-open"])],2)}}},pe={class:"flex items-start gap-2"},ge={class:"flex flex-col"},he={class:"text-sm font-bold"},be={key:0,class:"text-neutral-600"},ye={class:"font-light text-xs text-gray-400"},we={class:""},Re={__name:"Message",props:{item:{type:Object,required:!0}},setup(h){const n=h;return(e,_)=>{var d,c,x,p,g;return r(),u("div",pe,[m(z,{src:(d=n.item.user)==null?void 0:d.avatar},null,8,["src"]),t("div",ge,[t("div",he,[((x=(c=e.$page.props.user)==null?void 0:c.data)==null?void 0:x.id)===((p=n.item.user)==null?void 0:p.id)?(r(),u("span",be,"Вы:")):v("",!0),f(" "+a((g=n.item.user)==null?void 0:g.name)+" ",1),t("span",ye,a(n.item.created_at),1)]),t("div",we,a(n.item.message),1)])])}}};export{Ce as _,Re as a};
