import{_ as y}from"./ButtonComponent-6644ba4c.js";import{_ as S}from"./index-2a4984e8.js";import{_ as M}from"./Input-abd8a9ed.js";import{r as w,p as N,q,a as r,c as u,g as e,t as a,n as C,i as f,f as v,F as R,e as m,l as A,w as T,u as k,O as E}from"./app-babd44c3.js";import{u as F}from"./useToasts-95179251.js";import{_ as P}from"./Avatar-d988c74e.js";const z=e("div",{class:"font-semibold text-neutral-800 dark:text-slate-200"},"Запрос на бронирование",-1),D={class:"font-light text-xs text-gray-400"},U={class:"font-light text-neutral-800 dark:text-white"},G={class:"text-neutral-400 text-sm"},H={class:"font-light text-neutral-800 dark:text-slate-200"},I={key:0},J={class:"flex items-center gap-2"},K={class:"font-light text-neutral-800 dark:text-slate-200"},Q={class:"font-light text-neutral-800 dark:text-slate-200"},W={class:"font-light text-neutral-800 dark:text-slate-200"},X={key:0,class:"flex justify-end gap-2 mt-3"},Y={key:1,class:"font-light text-neutral-800"},Z={class:"divide-y divide-gray-100"},ee={class:"py-2 flex w-full items-baseline justify-between"},te=e("dt",{class:"font-light leading-6 text-пкфн-600"},[e("div",null,"Даты:")],-1),se={class:"mt-1 font-medium leading-6 text-neutral-600"},ae={class:"text-neutral-400 text-sm"},le={class:"py-2 flex w-full items-baseline justify-between"},oe=e("dt",{class:"font-light leading-6 text-пкфн-600"},[e("div",null,"Взрослые:")],-1),ne={class:"mt-1 font-medium leading-6 text-neutral-600"},ie={key:0,class:"py-2 flex w-full items-baseline justify-between"},re=e("dt",{class:"font-light leading-6 text-пкфн-600"},[e("div",null,"Дети:")],-1),ue={class:"mt-1 font-medium leading-6 text-neutral-600"},de={class:"py-2 flex w-full items-baseline justify-between"},ce={class:"font-light leading-6 text-пкфн-600"},ve={class:"mt-1 font-medium leading-6 text-neutral-600"},_e={class:"py-2 flex w-full items-baseline justify-between"},me=e("dt",{class:"font-light leading-6 text-пкфн-600"},[e("div",null,"Сервисный сбор:")],-1),fe={class:"mt-1 font-medium leading-6 text-neutral-600"},xe={class:"py-2 flex w-full items-baseline justify-between"},pe=e("dt",{class:"font-bold leading-6 text-neutral-800"},[e("div",null,"Итого:")],-1),ge={class:"mt-1 font-bold leading-6 text-neutral-800"},Te={__name:"ReservationRequest",props:{item:{required:!0},compact:{type:Boolean,default:!1},isOwner:{type:Boolean,default:!1}},setup(h){const n=h,t=w(n.item),_=w(!1),d=w(!1),c=N({status_text:""}),{infoToast:x,successToast:p,errorToast:g}=F(),V=()=>{axios.post(route("account.reservation-requests.reject",{reservationRequest:t.value.id}),{status_text:c.status_text}).then(l=>{var s,o;_.value=!1,t.value.status=(s=l.data)==null?void 0:s.status,t.value.status_text=(o=l.data)==null?void 0:o.status_text,x("Отказано в запросе на бронирование.")}).catch(l=>{var s,o,i,j,O;((s=l.response)==null?void 0:s.status)===422&&(console.log("error.response?.data?.message",(i=(o=l.response)==null?void 0:o.data)==null?void 0:i.message),c.setError("status_text",((O=(j=l.response)==null?void 0:j.data)==null?void 0:O.message)??"Что-то пошло не так."))})},B=()=>{axios.post(route("account.reservation-requests.submit",{reservationRequest:t.value.id})).then(l=>{var s,o;d.value=!1,t.value.status=(s=l.data)==null?void 0:s.status,t.value.reservation_id=(o=l.data)==null?void 0:o.reservation_id,p("Создано новое бронирование. Ожидайте оплату.")}).catch(l=>{g("Что-то пошло не так.")})},L=()=>{var l,s;if((l=t.value.reservation)!=null&&l.id){const o=n.isOwner?"account.reservations.owner.view":"account.reservations.view";E.visit(route(o,{reservation:(s=t.value.reservation)==null?void 0:s.id}))}},b=q(()=>Math.ceil(t.value.price*.18)),$=q(()=>t.value.price+b.value);return(l,s)=>{var o;return r(),u("div",{class:C(["border border-gray-300 dark:border-slate-700 rounded-lg p-3",[t.value.status==="rejected"?"opacity-40":"",t.value.status==="submitted"?"border-teal-600":""]])},[e("div",{class:C(["flex items-baseline justify-between",n.compact?"flex-col-reverse gap-0":"gap-4"])},[z,e("div",D,a(t.value.created_at),1)],2),e("div",U,[f(" с "+a(t.value.start)+" по "+a(t.value.end)+" | ",1),e("span",G,"ночи: "+a(t.value.range),1)]),e("div",H,[f(" Взрослые: "+a(t.value.guests)+" ",1),t.value.children>0?(r(),u("span",I," | Дети: "+a(t.value.children),1)):v("",!0)]),e("div",J,[e("div",K," Цена: "+a(t.value.price.toLocaleString())+"₽ ",1),f(" | "),e("div",Q," Сервисный сбор: "+a(b.value.toLocaleString())+"₽ ",1)]),e("div",W,"Итого: "+a($.value.toLocaleString())+"₽",1),n.compact?v("",!0):(r(),u("div",X,[n.isOwner?(r(),u(R,{key:0},[t.value.status==="pending"?(r(),u(R,{key:0},[m(y,{label:"Отказать",onClick:s[0]||(s[0]=i=>_.value=!0),small:!0,outline:!0,"auto-width":!0,class:"px-3"}),m(y,{label:"Подтвердить",onClick:s[1]||(s[1]=i=>d.value=!0),small:!0,"bg-class":"bg-green-50","text-class":"text-green-800","border-class":"border-green-800","auto-width":!0,class:"px-3"})],64)):v("",!0)],64)):v("",!0),t.value.status==="submitted"&&((o=t.value.reservation)!=null&&o.id)?(r(),A(y,{key:1,label:"К бронированию",small:!0,outline:!0,"auto-width":!0,onClick:L,class:"px-3"})):v("",!0)])),t.value.status==="rejected"?(r(),u("div",Y,a(`Отказано${t.value.status_text?": "+t.value.status_text:""}`),1)):v("",!0),m(S,{"is-open":_.value,onOnSecondaryAction:s[3]||(s[3]=i=>_.value=!1),onOnClose:s[4]||(s[4]=i=>_.value=!1),onOnSubmit:V,title:"Отказать в запросе на бронирование","action-label":"Отказать","secondary-action-label":"Отменить"},{body:T(()=>[m(M,{modelValue:k(c).status_text,"onUpdate:modelValue":s[2]||(s[2]=i=>k(c).status_text=i),id:"reason",name:"reason",error:k(c).errors.status_text,label:"Укажите причину отказа (можно не указывать)"},null,8,["modelValue","error"])]),_:1},8,["is-open"]),m(S,{"is-open":d.value,onOnSecondaryAction:s[5]||(s[5]=i=>d.value=!1),onOnClose:s[6]||(s[6]=i=>d.value=!1),onOnSubmit:B,title:"Подтвердить запрос на бронирование","action-label":"Подтвердить","secondary-action-label":"Отменить"},{body:T(()=>[e("dl",Z,[e("div",ee,[te,e("dd",se,[f(" с "+a(t.value.start)+" по "+a(t.value.end)+" | ",1),e("span",ae,"ночи: "+a(t.value.range),1)])]),e("div",le,[oe,e("dd",ne,a(t.value.guests),1)]),t.value.children>0?(r(),u("div",ie,[re,e("dd",ue,a(t.value.children),1)])):v("",!0),e("div",de,[e("dt",ce,[e("div",null,a(t.value.range)+" ночи:",1)]),e("dd",ve,a(t.value.price.toLocaleString())+"₽ ",1)]),e("div",_e,[me,e("dd",fe,a(b.value.toLocaleString())+"₽ ",1)]),e("div",xe,[pe,e("dd",ge,a($.value.toLocaleString())+"₽",1)])])]),_:1},8,["is-open"])],2)}}},he={class:"flex items-start gap-2"},be={class:"flex flex-col"},ye={class:"text-sm font-bold"},we={key:0,class:"text-neutral-600"},ke={class:"font-light text-xs text-gray-400"},$e={class:""},Ve={__name:"Message",props:{item:{type:Object,required:!0}},setup(h){const n=h;return(t,_)=>{var d,c,x,p,g;return r(),u("div",he,[m(P,{src:(d=n.item.user)==null?void 0:d.avatar},null,8,["src"]),e("div",be,[e("div",ye,[((x=(c=t.$page.props.user)==null?void 0:c.data)==null?void 0:x.id)===((p=n.item.user)==null?void 0:p.id)?(r(),u("span",we,"Вы:")):v("",!0),f(" "+a((g=n.item.user)==null?void 0:g.name)+" ",1),e("span",ke,a(n.item.created_at),1)]),e("div",$e,a(n.item.message),1)])])}}};export{Te as _,Ve as a};
