function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,o)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?I(Object(n),!0).forEach(function(o){N(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function L(e){return(L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function P(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function z(e){return function(t){if(Array.isArray(t))return j(t)}(e)||function(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}(e)||function(t,n){if(t){if(typeof t=="string")return j(t,n);var o=Object.prototype.toString.call(t).slice(8,-1);if(o==="Object"&&t.constructor&&(o=t.constructor.name),o==="Map"||o==="Set")return Array.from(t);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return j(t,n)}}(e)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function j(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function S(e,t){var n=t.options,o=t.callbacks,r=t.map,a=t.useObjectManager,u=t.objectManagerClusterize,m=t.useHtmlInLayout?`
    <div v-html="properties.balloonContentHeader"></div>
    <div v-html="properties.balloonContentBody"></div>
    <div v-html="properties.balloonContentFooter"></div>
  `:`
    <div>{{ properties.balloonContentHeader }}</div>
    <div>{{ properties.balloonContentBody }}</div>
    <div>{{ properties.balloonContentFooter }}</div>
  `,s={},l=[];if(e.forEach(function(i){i.clusterName?s[i.clusterName]=s[i.clusterName]?[].concat(z(s[i.clusterName]),[i]):[i]:l.push(i)}),Object.keys(s).forEach(function(i){var p=M({},n[i])||{},c=o[i]||{},y=p.layout||m;p.clusterBalloonItemContentLayout=ymaps.templateLayoutFactory.createClass(y);var f=p.clusterBalloonLayout||p.clusterLayout;delete p.clusterBalloonLayout;var k=f?ymaps.templateLayoutFactory.createClass(f):p.clusterBalloonContentLayout||"cluster#balloonTwoColumns";p.clusterBalloonContentLayout=k;var O=p.clusterIconContentLayout;if(p.clusterIconContentLayout=O&&ymaps.templateLayoutFactory.createClass(O),a){var g=new ymaps.ObjectManager(Object.assign({clusterize:u},p));Object.keys(c).forEach(function(b){g.clusters.events.add(b,c[b])}),g.add(s[i]),r.geoObjects.add(g)}else{var h=new ymaps.Clusterer(p);Object.keys(c).forEach(function(b){h.events.add(b,c[b])}),p.createCluster&&(h.createCluster=p.createCluster),h.add(s[i]),r.geoObjects.add(h)}}),l.length){var d=a?new ymaps.ObjectManager({clusterize:!1}):new ymaps.GeoObjectCollection;l.forEach(function(i){return d.add(i)}),r.geoObjects.add(d)}}function T(e){return e.charAt(0).toUpperCase()+e.slice(1)}function x(e){return(e.icon.color||"blue")+(e.icon.glyph?T(e.icon.glyph):e.icon.content?"Stretchy":"")}function E(e){return e.map(function(t){return Array.isArray(t)?E(t):+t})}function H(e,t){var n=[];return function o(r,a){if(r===a)return!0;if(r instanceof Date&&a instanceof Date)return+r==+a;if(typeof r=="function"&&typeof a=="function")return!0;if(L(r)!=="object"||L(a)!=="object")return!1;if(function(s,l){for(var d=n.length;d--;)if(!(n[d][0]!==s&&n[d][0]!==l||n[d][1]!==l&&n[d][1]!==s))return!0;return!1}(r,a))return!0;n.push([r,a]);var u=Object.keys(r),m=u.length;if(Object.keys(a).length!==m)return!1;for(;m--;)if(!o(r[u[m]],a[u[m]]))return!1;return!0}(e,t)}var v=new(function(){function e(){(function(o,r){if(!(o instanceof r))throw new TypeError("Cannot call a class as a function")})(this,e),this.events={},this.ymapReady=!1,this.scriptIsNotAttached=!0}var t,n;return t=e,(n=[{key:"$on",value:function(o,r){var a=this;return this.events[o]||(this.events[o]=[]),this.events[o].push(r),function(){a.events[o]=a.events[o].filter(function(u){return r!==u})}}},{key:"$emit",value:function(o,r){var a=this.events[o];a&&a.forEach(function(u){return u(r)})}}])&&P(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}()),V=["fullscreenControl","geolocationControl","routeEditor","rulerControl","searchControl","trafficControl","typeSelector","zoomControl","routeButtonControl","routePanelControl","smallMapDefaultSet","mediumMapDefaultSet","largeMapDefaultSet"];function $(e){return e.filter(function(t){return![].concat(V,["default"]).includes(t)}).length===0}function B(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new Promise(function(t,n){if(window.ymaps)return t();if(document.getElementById("vue-yandex-maps"))v.$on("scriptIsLoaded",t);else{var o=document.createElement("SCRIPT"),r=e.apiKey,a=r===void 0?"":r,u=e.suggestApiKey,m=u===void 0?"":u,s=e.lang,l=s===void 0?"ru_RU":s,d=e.version,i=d===void 0?"2.1":d,p=e.coordorder,c=p===void 0?"latlong":p,y=e.debug,f=y!==void 0&&y,k=e.enterprise,O=k!==void 0&&k,g=f?"debug":"release",h="lang=".concat(l).concat(a&&"&apikey=".concat(a),"&mode=").concat(g,"&coordorder=").concat(c);m&&(h+="&suggest_apikey=".concat(m));var b="https://".concat(O?"enterprise.":"","api-maps.yandex.ru/").concat(i,"/?").concat(h);o.setAttribute("src",b),o.setAttribute("async",""),o.setAttribute("defer",""),o.setAttribute("id","vue-yandex-maps"),document.head.appendChild(o),v.scriptIsNotAttached=!1,o.onload=function(){ymaps.ready(function(){v.ymapReady=!0,v.$emit("scriptIsLoaded"),t()})},o.onerror=n}})}var F,A=1,w=v,D=["actionend","balloonclose","balloonopen","click","contextmenu","dblclick","destroy","hintclose","hintopen","optionschange","sizechange","typechange"],C={pluginOptions:{},provide:function(){var e,t,n,o,r,a,u=this,m=[],s=[];return this.balloonComponent!=null&&(o=this.balloonComponent,r=null,a="vue-balloon-".concat(A),A+=1,n=function(l,d){var i=ymaps.templateLayoutFactory.createClass('<div id="'.concat(a,'"><div>'),{build:function(){i.superclass.build.call(this),(r=new F({parent:l.$root,data:function(){return{props:l.$props,listeners:l.$listeners}},propsData:{marker:d,component:o}})).$mount("#".concat(a))},clear:function(){r.$destroy(),r=null,i.superclass.clear.call(this)}});return i}),{useObjectManager:this.useObjectManager,addMarker:this.addMarker,deleteMarker:function(l){u.myMap.geoObjects&&(m.push(l),e&&clearTimeout(e),e=setTimeout(function(){u.deleteMarkers(m),m=[]},0))},compareValues:function(l){var d=l.newVal,i=l.oldVal,p=l.marker;H(d,i)||(s.push(p),t&&clearTimeout(t),t=setTimeout(function(){u.setMarkers(s),s=[]},0))},makeComponentBalloonTemplate:n}},data:function(){return{ymapId:"yandexMap".concat(Math.round(1e5*Math.random())),style:this.ymapClass?"":"width: 100%; height: 100%;",isReady:!1,debounce:null}},props:{coords:{type:Array,required:!0},zoom:{validator:function(e){return!Number.isNaN(e)},default:18},bounds:Array,clusterOptions:{type:Object,default:function(){return{}}},clusterCallbacks:{type:Object,default:function(){return{}}},behaviors:{type:Array,default:function(){return["default"]}},controls:{type:Array,default:function(){return["default"]},validator:function(e){return $(e)}},detailedControls:{type:Object,validator:function(e){return $(Object.keys(e))}},scrollZoom:{type:Boolean,default:!0},mapType:{type:String,default:"map",validator:function(e){return["map","satellite","hybrid"].includes(e)}},placemarks:{type:Array,default:function(){return[]}},useObjectManager:{type:Boolean,default:!1},objectManagerClusterize:{type:Boolean,default:!0},ymapClass:String,initWithoutMarkers:{type:Boolean,default:!0},debug:{type:Boolean,default:!1},settings:{type:Object,default:function(){return{}}},options:{type:Object,default:function(){return{}}},mapEvents:{type:Array,default:function(){return[]}},showAllMarkers:Boolean,disablePan:Boolean,balloonComponent:{type:[Object,Function],default:function(){return null}},useHtmlInLayout:Boolean},computed:{coordinates:function(){return this.coords.map(function(e){return+e})}},methods:{init:function(){var e=this;this.myMap={},this.markers=[],window.ymaps&&ymaps.GeoObjectCollection&&(this.initWithoutMarkers||this.$slots.default||this.placemarks.length)&&document.getElementById(this.ymapId)&&(this.$emit("map-initialization-started"),this.myMap=new ymaps.Map(this.ymapId,{center:this.coordinates,zoom:+this.zoom,bounds:this.bounds,behaviors:this.behaviors,controls:this.controls,type:"yandex#".concat(this.mapType)},this.options),(this.mapEvents.length?this.mapEvents:D).forEach(function(t){return e.myMap.events.add(t,function(n){return e.$emit(t,n)})}),this.myMap.events.add("boundschange",function(t){var n=t.originalEvent,o=n.newZoom,r=n.newCenter,a=n.newBounds;e.$emit("boundschange",t),e.$emit("update:zoom",o),e.$emit("update:coords",r),e.$emit("update:bounds",a)}),this.detailedControls&&Object.keys(this.detailedControls).forEach(function(t){e.myMap.controls.remove(t),e.myMap.controls.add(t,e.detailedControls[t])}),this.scrollZoom===!1&&this.myMap.behaviors.disable("scrollZoom"),this.isReady=!0,this.$emit("map-was-initialized",this.myMap))},addMarker:function(e){var t=this;this.markers.push(e),this.debounce&&clearTimeout(this.debounce),this.debounce=setTimeout(function(){t.setMarkers(t.markers)},0)},setMarkers:function(e){var t=this,n={options:this.clusterOptions,callbacks:this.clusterCallbacks,map:this.myMap,useObjectManager:this.useObjectManager,objectManagerClusterize:this.objectManagerClusterize,useHtmlInLayout:this.useHtmlInLayout};if(this.markers!==e){var o=e.map(function(r){return t.useObjectManager?r.id:r.properties.get("markerId")});this.deleteMarkers(o),S(e,n),this.$emit("markers-was-change",o)}else S(e,n);this.markers=[],this.showAllMarkers&&this.myMap.setBounds(this.myMap.geoObjects.getBounds())},deleteMarkers:function(e){var t=this,n=[];this.myMap.geoObjects.each(function(o){return n.push(o)}),n.forEach(function(o){var r=[];if(t.useObjectManager)o.remove(e);else{var a,u=function(s){var l=s.properties.get("markerId");e.includes(l)&&r.push(s)};if(o.each)o.each(u),a=o.getLength();else if(o.getGeoObjects){var m=o.getGeoObjects();m.forEach(u),a=m.length}a===0||a===r.length?t.myMap.geoObjects.remove(o):r.length&&r.forEach(function(s){return o.remove(s)})}}),this.$emit("markers-was-delete",e)}},watch:{coordinates:function(e){this.myMap&&(this.disablePan?this.myMap.setCenter&&this.myMap.setCenter(e):this.myMap.panTo&&this.myMap.getZoom()&&this.myMap.panTo(e,{checkZoomRange:!0}))},zoom:function(){this.myMap&&this.myMap.setZoom(this.zoom)},bounds:function(e){this.myMap&&this.myMap.setBounds&&this.myMap.setBounds(e)}},render:function(e){return e("section",{class:"ymap-container",ref:"mapContainer"},[e("div",{attrs:{id:this.ymapId,class:this.ymapClass,style:this.style}}),this.isReady&&e("div",[this.$slots.default])])},mounted:function(){var e=this;if(this.$attrs["map-link"]||this.$attrs.mapLink)throw new Error("Vue-yandex-maps: Attribute mapLink is not supported. Use settings.");if(this.placemarks&&this.placemarks.length)throw new Error("Vue-yandex-maps: Attribute placemarks is not supported. Use marker component.");this.mapObserver=new MutationObserver(function(){e.myMap.container&&e.myMap.container.fitToViewport()});var t=this.$refs.mapContainer;if(this.mapObserver.observe(t,{attributes:!0,childList:!0,characterData:!0,subtree:!1}),w.scriptIsNotAttached){var n=this.debug;B(M(M(M({},this.$options.pluginOptions),this.settings),{},{debug:n}))}w.ymapReady?ymaps.ready(this.init):w.$on("scriptIsLoaded",this.init)},beforeDestroy:function(){this.myMap&&this.myMap.geoObjects&&this.myMap.geoObjects.removeAll()}},R=["placemark","polyline","rectangle","polygon","circle"],Z=["balloonclose","balloonopen","click","contextmenu","dblclick","drag","dragend","dragstart","hintclose","hintopen","mouseenter","mouseleave"],U={inject:["useObjectManager","addMarker","deleteMarker","compareValues","makeComponentBalloonTemplate"],props:{coords:Array,hintContent:String,icon:Object,balloon:Object,markerType:{type:String,validator:function(e){return R.includes(e.toLowerCase())},default:"placemark"},markerFill:Object,markerStroke:Object,clusterName:[String,Number],circleRadius:{validator:function(e){return!Number.isNaN(e)},default:1e3},balloonTemplate:String,markerId:{type:[String,Number],required:!0},properties:Object,options:Object,balloonComponentProps:{type:Object,default:function(){return{}}},markerEvents:{type:Array,default:function(){return[]}}},data:function(){return{unwatchArr:[]}},render:function(e){return e("div",[this.$slots.balloon&&e("div",{style:"display: none;"},[this.$slots.balloon]),this.$slots.balloonLayout&&e("div",{style:"display: none;"},[this.$slots.balloonLayout])])},mounted:function(){var e=this;Object.keys(this.$props).forEach(function(t){t!=="balloonComponentProps"&&e.unwatchArr.push(e.$watch(t,function(n,o){return e.compareValues({newVal:n,oldVal:o,marker:e.defineMarker()})}))}),this.addMarker(this.defineMarker())},methods:{defineMarker:function(){var e=this,t={markerId:this.markerId,markerType:this.markerType||"placemark",coords:E(this.coords),hintContent:this.hintContent,markerFill:this.markerFill,circleRadius:+this.circleRadius,clusterName:this.clusterName,markerStroke:this.markerStroke,balloon:this.balloon,properties:this.properties,options:this.options,balloonOptions:{}},n=null,o=null;this.balloonTemplate&&(n=ymaps.templateLayoutFactory.createClass(this.balloonTemplate)),this.$slots.balloon&&(n=ymaps.templateLayoutFactory.createClass(this.$slots.balloon[0].elm.outerHTML)),this.$slots.balloonLayout&&(o=ymaps.templateLayoutFactory.createClass(this.$slots.balloonLayout[0].elm.outerHTML)),this.makeComponentBalloonTemplate&&(n=this.makeComponentBalloonTemplate(this,t)),n!=null&&(t.balloonOptions.balloonContentLayout=n),o!=null&&(t.balloonOptions.balloonLayout=o),this.icon&&["default#image","default#imageWithContent"].includes(this.icon.layout)?(t.iconContent=this.icon.content,t.iconLayout=this.icon.layout,t.iconImageHref=this.icon.imageHref,t.iconImageSize=this.icon.imageSize,t.iconImageOffset=this.icon.imageOffset,t.iconContentOffset=this.icon.contentOffset,this.icon.contentLayout&&typeof this.icon.contentLayout=="string"&&(t.iconContentLayout=ymaps.templateLayoutFactory.createClass(this.icon.contentLayout))):t.icon=this.icon;var r=function(c,y){var f=T(c);if(!y)return f;switch(f){case"Placemark":return"Point";case"Polyline":return"LineString";default:return f}}(t.markerType,this.useObjectManager),a={hintContent:t.hintContent,iconContent:t.icon?t.icon.content:t.iconContent,markerId:t.markerId},u=t.balloon?{balloonContentHeader:t.balloon.header,balloonContentBody:t.balloon.body,balloonContentFooter:t.balloon.footer}:{},m=Object.assign(a,u,t.properties),s=t.iconLayout?{iconLayout:t.iconLayout,iconImageHref:t.iconImageHref,iconImageSize:t.iconImageSize,iconImageOffset:t.iconImageOffset,iconContentOffset:t.iconContentOffset,iconContentLayout:t.iconContentLayout}:{preset:t.icon&&"islands#".concat(x(t),"Icon")},l=t.markerStroke?{strokeColor:t.markerStroke.color||"0066ffff",strokeOpacity:parseFloat(t.markerStroke.opacity)>=0?parseFloat(t.markerStroke.opacity):1,strokeStyle:t.markerStroke.style,strokeWidth:parseFloat(t.markerStroke.width)>=0?parseFloat(t.markerStroke.width):1}:{},d=t.markerFill?{fill:t.markerFill.enabled||!0,fillColor:t.markerFill.color||"0066ff99",fillOpacity:parseFloat(t.markerFill.opacity)>=0?parseFloat(t.markerFill.opacity):1,fillImageHref:t.markerFill.imageHref||""}:{},i=Object.assign(s,l,d,t.balloonOptions,t.options);r==="Circle"&&(t.coords=[t.coords,t.circleRadius]);var p=function(c,y){var f=y?{type:"Feature",id:c.properties.markerId,geometry:{type:c.markerType,coordinates:c.coords},properties:c.properties,options:c.options}:new ymaps[c.markerType](c.coords,c.properties,c.options);return f.clusterName=c.clusterName,f}({properties:m,options:i,markerType:r,coords:t.coords,clusterName:t.clusterName},this.useObjectManager,this.$emit);return this.useObjectManager||(this.markerEvents.length?this.markerEvents:Z).forEach(function(c){return p.events.add(c,function(y){return e.$emit(c,y)})}),p}},beforeDestroy:function(){this.unwatchArr.forEach(function(e){return e()}),this.deleteMarker(this.markerId)}};C.install=function e(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e.installed||(+t.version[0]!=3?(e.installed=!0,function(o){typeof o.extend=="function"&&(F=o.extend({props:["marker","component"],template:'<component :is="component" v-bind="{ marker, ...props.balloonComponentProps }" v-on="listeners" />'}))}(t),C.pluginOptions=n,t.component("yandex-map",C),t.component("ymap-marker",U)):console.warn("Vue-yandex-maps: This version is only compatible with Vue 2.X. Please install vue-yandex-maps@next"))},typeof window<"u"&&window.Vue&&window.Vue.use(C);var G=B;export{G as j};
