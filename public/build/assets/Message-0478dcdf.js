import{_ as $}from"./ButtonComponent-09c15ff3.js";import{_ as M}from"./index-e5c5aa4a.js";import{_ as U}from"./Input-f71ed4d7.js";import{r as O,p as G,q as T,a as o,c as n,g as e,t as a,n as N,i as _,f as u,F as p,e as m,l as H,w as P,u as q,O as I}from"./app-ba0b5d1d.js";import{u as J}from"./useToasts-fda62083.js";import{_ as K}from"./Avatar-96976c82.js";const Q=e("div",{class:"font-semibold text-neutral-800 dark:text-slate-200"},"Запрос на бронирование",-1),W={class:"font-light text-xs text-gray-400"},X={class:"font-light text-neutral-800 dark:text-white"},Y={class:"text-neutral-400 text-sm"},Z={class:"font-light text-neutral-800 dark:text-slate-200"},tt={key:0},et={class:"flex items-center gap-2 flex-wrap"},st={class:"font-light text-neutral-800 dark:text-slate-200"},at=e("span",{class:"dark:text-slate-300"},"|",-1),lt={class:"font-light text-neutral-800 dark:text-slate-200"},ot={key:0,class:"text-sm font-light text-right text-gray-500 dark:text-slate-400 mt-2"},it={key:1,class:"text-sm font-light text-right text-gray-500 dark:text-slate-400 mt-2"},nt={key:2,class:"text-sm font-light text-right text-emerald-500 dark:text-teal-400 mt-2"},rt={key:0,class:"flex justify-end gap-2 mt-3"},ut={id:"copy_payment_link",role:"tooltip",class:"absolute z-20 break-words whitespace-nowrap invisible inline-block px-3 py-2 text-xs font-medium text-white transition-opacity duration-300 bg-gray-900 rounded-lg shadow-sm opacity-0 tooltip dark:bg-gray-700"},dt=e("div",{class:"tooltip-arrow","data-popper-arrow":""},null,-1),ct={key:4,class:"font-light text-neutral-800"},vt=e("div",{class:"text-neutral-400 text-sm mt-1"},"Если укажете - то гость будет видеть причину отказа.",-1),_t={class:"divide-y divide-gray-100"},mt={class:"py-2 flex w-full items-baseline justify-between"},xt=e("dt",{class:"font-light leading-6 text-gray-600 dark:text-slate-300"},[e("div",null,"Даты:")],-1),pt={class:"mt-1 font-medium leading-6 text-neutral-600 dark:text-slate-200"},ft={class:"text-neutral-400 text-sm"},gt={class:"py-2 flex w-full items-baseline justify-between"},ht=e("dt",{class:"font-light leading-6 text-gray-600 dark:text-slate-300"},[e("div",null,"Взрослые:")],-1),yt={class:"mt-1 font-medium leading-6 text-neutral-600 dark:text-slate-200"},bt={key:0,class:"py-2 flex w-full items-baseline justify-between"},kt=e("dt",{class:"font-light leading-6 text-gray-600 dark:text-slate-300"},[e("div",null,"Дети:")],-1),wt={class:"mt-1 font-medium leading-6 text-neutral-600 dark:text-slate-200"},$t={class:"py-2 flex w-full items-baseline justify-between"},Ot={class:"font-light leading-6 text-gray-600 dark:text-slate-300"},jt={class:"mt-1 font-medium leading-6 text-neutral-600 dark:text-slate-200"},St={class:"py-2 flex w-full items-baseline justify-between"},Tt=e("dt",{class:"font-light leading-6 text-gray-600 dark:text-slate-300"},[e("div",null,"Первоначальный платеж:")],-1),qt={class:"mt-1 font-medium leading-6 text-neutral-600 dark:text-slate-200"},Dt={__name:"ReservationRequest",props:{item:{required:!0},compact:{type:Boolean,default:!1},isOwner:{type:Boolean,default:!1}},setup(j){const i=j,t=O(i.item),x=O(!1),d=O(!1),c=G({status_text:""}),{infoToast:y,successToast:b,errorToast:k}=J(),z=()=>{axios.post(route("account.reservation-requests.reject",{reservationRequest:t.value.id}),{status_text:c.status_text}).then(l=>{var s,r;x.value=!1,t.value.status=(s=l.data)==null?void 0:s.status,t.value.status_text=(r=l.data)==null?void 0:r.status_text,y("Отказано в запросе на бронирование.")}).catch(l=>{var s,r,f,g,h;((s=l.response)==null?void 0:s.status)===422&&(console.log("error.response?.data?.message",(f=(r=l.response)==null?void 0:r.data)==null?void 0:f.message),c.setError("status_text",((h=(g=l.response)==null?void 0:g.data)==null?void 0:h.message)??"Что-то пошло не так."))})},A=()=>{axios.post(route("account.reservation-requests.submit",{reservationRequest:t.value.id})).then(l=>{var s,r;d.value=!1,t.value.status=(s=l.data)==null?void 0:s.status,t.value.reservation_id=(r=l.data)==null?void 0:r.reservation_id,b("Создано новое бронирование. Ожидайте оплату.")}).catch(l=>{k("Что-то пошло не так.")})},E=()=>{var l,s;if((l=t.value.reservation)!=null&&l.id){const r=i.isOwner?"account.reservations.owner.view":"account.reservations.view";I.visit(route(r,{reservation:(s=t.value.reservation)==null?void 0:s.id}))}},w=O("Копировать ссылку на оплату"),F=()=>{var l;w.value="Скопировано",navigator.clipboard.writeText(route("account.reservations.pay",{reservation:(l=t.value.reservation)==null?void 0:l.id})).then(()=>{w.value="Скопировано",setTimeout(()=>{w.value="Копировать ссылку на оплату"},1500)})},D=T(()=>{const l=(t.value.price>=1e5,.15);return Math.ceil(t.value.price*l)}),S=T(()=>t.value.price+D.value),C=T(()=>Math.ceil(S.value*.3));return(l,s)=>{var r,f,g,h,R,V,B,L;return o(),n("div",{class:N(["border border-gray-300 dark:border-slate-700 rounded-lg p-3",[t.value.status==="rejected"?"opacity-40":"",t.value.status==="submitted"?"border-teal-600":""]])},[e("div",{class:N(["flex items-baseline justify-between",i.compact?"flex-col-reverse gap-0":"gap-4"])},[Q,e("div",W,a(t.value.created_at),1)],2),e("div",X,[_(" с "+a(t.value.start)+" по "+a(t.value.end)+" | ",1),e("span",Y,"ночи: "+a(t.value.range),1)]),e("div",Z,[_(" Взрослые: "+a(t.value.guests)+" ",1),t.value.children>0?(o(),n("span",tt," | Дети: "+a(t.value.children),1)):u("",!0)]),e("div",et,[e("div",st,"Цена: "+a(S.value.toLocaleString())+"₽",1),at,e("div",lt," Первоначальный платеж: "+a(C.value.toLocaleString())+"₽ ",1)]),t.value.status==="pending"&&!i.isOwner&&!i.compact?(o(),n("div",ot," Ожидаем решение собственника ")):u("",!0),t.value.status==="submitted"&&!i.compact&&(!((r=t.value.reservation)!=null&&r.id)||((f=t.value.reservation)==null?void 0:f.status)!=="paid")?(o(),n("div",it,[((g=t.value.reservation)==null?void 0:g.status)==="payment_waiting"?(o(),n(p,{key:0},[_(" Ожидаем одобрение платежа ")],64)):(o(),n(p,{key:1},[_(" Ожидаем оплату ")],64))])):u("",!0),t.value.status==="submitted"&&((h=t.value.reservation)!=null&&h.id)&&((R=t.value.reservation)==null?void 0:R.status)==="paid"?(o(),n("div",nt," Оплачен ")):u("",!0),i.compact?u("",!0):(o(),n(p,{key:3},[i.isOwner||t.value.status==="submitted"&&((V=t.value.reservation)!=null&&V.id)?(o(),n("div",rt,[i.isOwner?(o(),n(p,{key:0},[t.value.status==="pending"?(o(),n(p,{key:0},[m($,{label:"Отказать",onClick:s[0]||(s[0]=v=>x.value=!0),small:!0,outline:!0,"auto-width":!0,class:"px-3"}),m($,{label:"Подтвердить",onClick:s[1]||(s[1]=v=>d.value=!0),small:!0,"bg-class":"bg-green-50","text-class":"text-green-800","border-class":"border-green-800","auto-width":!0,class:"px-3"})],64)):u("",!0)],64)):u("",!0),t.value.status==="submitted"&&((B=t.value.reservation)!=null&&B.id)?(o(),n(p,{key:1},[i.isOwner&&((L=t.value.reservation)==null?void 0:L.status)!=="paid"?(o(),H($,{key:0,label:"Ссылка на оплату",small:!0,outline:!0,"auto-width":!0,"data-tooltip-target":"copy_payment_link",onClick:F,class:"px-3"})):u("",!0),e("div",ut,[_(a(w.value)+" ",1),dt]),m($,{label:"К бронированию",small:!0,outline:!0,"auto-width":!0,onClick:E,class:"px-3"})],64)):u("",!0)])):u("",!0)],64)),t.value.status==="rejected"?(o(),n("div",ct,a(`Отказано${t.value.status_text?": "+t.value.status_text:""}`),1)):u("",!0),m(M,{"is-open":x.value,onOnSecondaryAction:s[3]||(s[3]=v=>x.value=!1),onOnClose:s[4]||(s[4]=v=>x.value=!1),onOnSubmit:z,title:"Отказать в запросе на бронирование","action-label":"Отказать","secondary-action-label":"Отменить"},{body:P(()=>[m(U,{modelValue:q(c).status_text,"onUpdate:modelValue":s[2]||(s[2]=v=>q(c).status_text=v),id:"reason",name:"reason",error:q(c).errors.status_text,label:"Укажите причину отказа (можно не указывать)"},null,8,["modelValue","error"]),vt]),_:1},8,["is-open"]),m(M,{"is-open":d.value,onOnSecondaryAction:s[5]||(s[5]=v=>d.value=!1),onOnClose:s[6]||(s[6]=v=>d.value=!1),onOnSubmit:A,title:"Подтвердить запрос на бронирование","action-label":"Подтвердить","secondary-action-label":"Отменить"},{body:P(()=>[e("dl",_t,[e("div",mt,[xt,e("dd",pt,[_(" с "+a(t.value.start)+" по "+a(t.value.end)+" | ",1),e("span",ft,"ночи: "+a(t.value.range),1)])]),e("div",gt,[ht,e("dd",yt,a(t.value.guests),1)]),t.value.children>0?(o(),n("div",bt,[kt,e("dd",wt,a(t.value.children),1)])):u("",!0),e("div",$t,[e("dt",Ot,[e("div",null,a(t.value.range)+" ночи:",1)]),e("dd",jt,a(S.value.toLocaleString())+"₽ ",1)]),e("div",St,[Tt,e("dd",qt,a(C.value.toLocaleString())+"₽ ",1)])])]),_:1},8,["is-open"])],2)}}},Ct={class:"flex items-start gap-2"},Rt={class:"flex flex-col"},Vt={class:"text-sm font-bold"},Bt={key:0,class:"text-neutral-600"},Lt={class:"font-light text-xs text-gray-400"},Mt={class:""},Ut={__name:"Message",props:{item:{type:Object,required:!0}},setup(j){const i=j;return(t,x)=>{var d,c,y,b,k;return o(),n("div",Ct,[m(K,{src:(d=i.item.user)==null?void 0:d.avatar},null,8,["src"]),e("div",Rt,[e("div",Vt,[((y=(c=t.$page.props.user)==null?void 0:c.data)==null?void 0:y.id)===((b=i.item.user)==null?void 0:b.id)?(o(),n("span",Bt,"Вы:")):u("",!0),_(" "+a((k=i.item.user)==null?void 0:k.name)+" ",1),e("span",Lt,a(i.item.created_at),1)]),e("div",Mt,a(i.item.message),1)])])}}};export{Dt as _,Ut as a};
