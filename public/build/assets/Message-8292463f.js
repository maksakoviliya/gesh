import{_ as $}from"./ButtonComponent-db8ab898.js";import{_ as R}from"./index-a147edd7.js";import{_ as P}from"./Input-d93a857d.js";import{r as O,p as A,q as j,a as n,c as r,g as e,t as a,n as T,i as b,f as u,F as S,e as m,l as E,w as V,u as q,O as F}from"./app-0fdafa21.js";import{u as z}from"./useToasts-ba4d4ac2.js";import{_ as D}from"./Avatar-c3406250.js";const U=e("div",{class:"font-semibold text-neutral-800 dark:text-slate-200"},"Запрос на бронирование",-1),G={class:"font-light text-xs text-gray-400"},H={class:"font-light text-neutral-800 dark:text-white"},I={class:"text-neutral-400 text-sm"},J={class:"font-light text-neutral-800 dark:text-slate-200"},K={key:0},Q={class:"flex items-center gap-2 flex-wrap"},W={class:"font-light text-neutral-800 dark:text-slate-200"},X=e("span",{class:"dark:text-slate-300"},"|",-1),Y={class:"font-light text-neutral-800 dark:text-slate-200"},Z={key:0,class:"text-sm font-light text-right text-gray-500 dark:text-slate-400 mt-2"},tt={key:1,class:"text-sm font-light text-right text-gray-500 dark:text-slate-400 mt-2"},et={key:2,class:"text-sm font-light text-right text-emerald-500 dark:text-teal-400 mt-2"},st={key:0,class:"flex justify-end gap-2 mt-3"},at={key:4,class:"font-light text-neutral-800"},lt=e("div",{class:"text-neutral-400 text-sm mt-1"},"Если укажете - то гость будет видеть причину отказа.",-1),ot={class:"divide-y divide-gray-100"},nt={class:"py-2 flex w-full items-baseline justify-between"},it=e("dt",{class:"font-light leading-6 text-gray-600 dark:text-slate-300"},[e("div",null,"Даты:")],-1),rt={class:"mt-1 font-medium leading-6 text-neutral-600 dark:text-slate-200"},ut={class:"text-neutral-400 text-sm"},dt={class:"py-2 flex w-full items-baseline justify-between"},ct=e("dt",{class:"font-light leading-6 text-gray-600 dark:text-slate-300"},[e("div",null,"Взрослые:")],-1),vt={class:"mt-1 font-medium leading-6 text-neutral-600 dark:text-slate-200"},_t={key:0,class:"py-2 flex w-full items-baseline justify-between"},mt=e("dt",{class:"font-light leading-6 text-gray-600 dark:text-slate-300"},[e("div",null,"Дети:")],-1),xt={class:"mt-1 font-medium leading-6 text-neutral-600 dark:text-slate-200"},ft={class:"py-2 flex w-full items-baseline justify-between"},gt={class:"font-light leading-6 text-gray-600 dark:text-slate-300"},pt={class:"mt-1 font-medium leading-6 text-neutral-600 dark:text-slate-200"},ht={class:"py-2 flex w-full items-baseline justify-between"},yt=e("dt",{class:"font-light leading-6 text-gray-600 dark:text-slate-300"},[e("div",null,"Первоначальный платеж:")],-1),bt={class:"mt-1 font-medium leading-6 text-neutral-600 dark:text-slate-200"},Mt={__name:"ReservationRequest",props:{item:{required:!0},compact:{type:Boolean,default:!1},isOwner:{type:Boolean,default:!1}},setup(k){const l=k,t=O(l.item),_=O(!1),d=O(!1),c=A({status_text:""}),{infoToast:p,successToast:h,errorToast:y}=z(),B=()=>{axios.post(route("account.reservation-requests.reject",{reservationRequest:t.value.id}),{status_text:c.status_text}).then(o=>{var s,i;_.value=!1,t.value.status=(s=o.data)==null?void 0:s.status,t.value.status_text=(i=o.data)==null?void 0:i.status_text,p("Отказано в запросе на бронирование.")}).catch(o=>{var s,i,x,f,g;((s=o.response)==null?void 0:s.status)===422&&(console.log("error.response?.data?.message",(x=(i=o.response)==null?void 0:i.data)==null?void 0:x.message),c.setError("status_text",((g=(f=o.response)==null?void 0:f.data)==null?void 0:g.message)??"Что-то пошло не так."))})},M=()=>{axios.post(route("account.reservation-requests.submit",{reservationRequest:t.value.id})).then(o=>{var s,i;d.value=!1,t.value.status=(s=o.data)==null?void 0:s.status,t.value.reservation_id=(i=o.data)==null?void 0:i.reservation_id,h("Создано новое бронирование. Ожидайте оплату.")}).catch(o=>{y("Что-то пошло не так.")})},L=()=>{var o,s;if((o=t.value.reservation)!=null&&o.id){const i=l.isOwner?"account.reservations.owner.view":"account.reservations.view";F.visit(route(i,{reservation:(s=t.value.reservation)==null?void 0:s.id}))}},N=j(()=>{const o=(t.value.price>=1e5,.15);return Math.ceil(t.value.price*o)}),w=j(()=>t.value.price+N.value),C=j(()=>Math.ceil(w.value*.3));return(o,s)=>{var i,x,f,g;return n(),r("div",{class:T(["border border-gray-300 dark:border-slate-700 rounded-lg p-3",[t.value.status==="rejected"?"opacity-40":"",t.value.status==="submitted"?"border-teal-600":""]])},[e("div",{class:T(["flex items-baseline justify-between",l.compact?"flex-col-reverse gap-0":"gap-4"])},[U,e("div",G,a(t.value.created_at),1)],2),e("div",H,[b(" с "+a(t.value.start)+" по "+a(t.value.end)+" | ",1),e("span",I,"ночи: "+a(t.value.range),1)]),e("div",J,[b(" Взрослые: "+a(t.value.guests)+" ",1),t.value.children>0?(n(),r("span",K," | Дети: "+a(t.value.children),1)):u("",!0)]),e("div",Q,[e("div",W,"Цена: "+a(w.value.toLocaleString())+"₽",1),X,e("div",Y," Первоначальный платеж: "+a(C.value.toLocaleString())+"₽ ",1)]),t.value.status==="pending"&&!l.isOwner&&!l.compact?(n(),r("div",Z," Ожидаем решение собственника "+a(t.value.status)+" "+a(l.isOwner),1)):u("",!0),t.value.status==="submitted"&&!l.compact&&!((i=t.value.reservation)!=null&&i.id)?(n(),r("div",tt," Ожидаем оплату ")):u("",!0),t.value.status==="submitted"&&((x=t.value.reservation)!=null&&x.id)?(n(),r("div",et," Оплачен ")):u("",!0),l.compact?u("",!0):(n(),r(S,{key:3},[l.isOwner||t.value.status==="submitted"&&((f=t.value.reservation)!=null&&f.id)?(n(),r("div",st,[l.isOwner?(n(),r(S,{key:0},[t.value.status==="pending"?(n(),r(S,{key:0},[m($,{label:"Отказать",onClick:s[0]||(s[0]=v=>_.value=!0),small:!0,outline:!0,"auto-width":!0,class:"px-3"}),m($,{label:"Подтвердить",onClick:s[1]||(s[1]=v=>d.value=!0),small:!0,"bg-class":"bg-green-50","text-class":"text-green-800","border-class":"border-green-800","auto-width":!0,class:"px-3"})],64)):u("",!0)],64)):u("",!0),t.value.status==="submitted"&&((g=t.value.reservation)!=null&&g.id)?(n(),E($,{key:1,label:"К бронированию",small:!0,outline:!0,"auto-width":!0,onClick:L,class:"px-3"})):u("",!0)])):u("",!0)],64)),t.value.status==="rejected"?(n(),r("div",at,a(`Отказано${t.value.status_text?": "+t.value.status_text:""}`),1)):u("",!0),m(R,{"is-open":_.value,onOnSecondaryAction:s[3]||(s[3]=v=>_.value=!1),onOnClose:s[4]||(s[4]=v=>_.value=!1),onOnSubmit:B,title:"Отказать в запросе на бронирование","action-label":"Отказать","secondary-action-label":"Отменить"},{body:V(()=>[m(P,{modelValue:q(c).status_text,"onUpdate:modelValue":s[2]||(s[2]=v=>q(c).status_text=v),id:"reason",name:"reason",error:q(c).errors.status_text,label:"Укажите причину отказа (можно не указывать)"},null,8,["modelValue","error"]),lt]),_:1},8,["is-open"]),m(R,{"is-open":d.value,onOnSecondaryAction:s[5]||(s[5]=v=>d.value=!1),onOnClose:s[6]||(s[6]=v=>d.value=!1),onOnSubmit:M,title:"Подтвердить запрос на бронирование","action-label":"Подтвердить","secondary-action-label":"Отменить"},{body:V(()=>[e("dl",ot,[e("div",nt,[it,e("dd",rt,[b(" с "+a(t.value.start)+" по "+a(t.value.end)+" | ",1),e("span",ut,"ночи: "+a(t.value.range),1)])]),e("div",dt,[ct,e("dd",vt,a(t.value.guests),1)]),t.value.children>0?(n(),r("div",_t,[mt,e("dd",xt,a(t.value.children),1)])):u("",!0),e("div",ft,[e("dt",gt,[e("div",null,a(t.value.range)+" ночи:",1)]),e("dd",pt,a(w.value.toLocaleString())+"₽ ",1)]),e("div",ht,[yt,e("dd",bt,a(C.value.toLocaleString())+"₽ ",1)])])]),_:1},8,["is-open"])],2)}}},kt={class:"flex items-start gap-2"},wt={class:"flex flex-col"},$t={class:"text-sm font-bold"},Ot={key:0,class:"text-neutral-600"},jt={class:"font-light text-xs text-gray-400"},St={class:""},Lt={__name:"Message",props:{item:{type:Object,required:!0}},setup(k){const l=k;return(t,_)=>{var d,c,p,h,y;return n(),r("div",kt,[m(D,{src:(d=l.item.user)==null?void 0:d.avatar},null,8,["src"]),e("div",wt,[e("div",$t,[((p=(c=t.$page.props.user)==null?void 0:c.data)==null?void 0:p.id)===((h=l.item.user)==null?void 0:h.id)?(n(),r("span",Ot,"Вы:")):u("",!0),b(" "+a((y=l.item.user)==null?void 0:y.name)+" ",1),e("span",jt,a(l.item.created_at),1)]),e("div",St,a(l.item.message),1)])])}}};export{Mt as _,Lt as a};
