import{d as m,_ as R,c as U}from"./AppLayout-f2ae67e0.js";import{_ as G}from"./Container-d2a8b8e7.js";import{_ as z}from"./Heading-59bb40fe.js";import{d as J,h as K,a as f,c as p,e as t,m as I,r as L,q as w,l as Q,w as l,g as d,t as s,i as Y,u as C,f as c,v as W,b as X,F as Z,O as tt}from"./app-d2d96d6e.js";import{c as V}from"./customParseFormat-fd104cc5.js";import{_ as et}from"./ButtonComponent-d2247bd2.js";import{_ as st}from"./Breadcrumbs-8562428b.js";import{_ as at}from"./_plugin-vue_export-helper-c27b6911.js";import"./index.esm.min-77aea112.js";import"./Counter-45d81b26.js";import"./index-fcfb796a.js";import"./Input-c536d279.js";import"./index-9ef572b0.js";import"./Avatar-8641ce2c.js";import"./index-87d96d81.js";import"./useToasts-a9a2f36d.js";/*! vue-countdown v2.1.2 | (c) 2018-present Chen Fengyuan | MIT */const S=1e3,$=60*S,E=60*$,j=24*E,O="abort",B="end",H="progress",A="start",F="visibilitychange";var it=J({name:"VueCountdown",props:{autoStart:{type:Boolean,default:!0},emitEvents:{type:Boolean,default:!0},interval:{type:Number,default:1e3,validator:a=>a>=0},now:{type:Function,default:()=>Date.now()},tag:{type:String,default:"span"},time:{type:Number,default:0,validator:a=>a>=0},transform:{type:Function,default:a=>a}},emits:[O,B,H,A],data(){return{counting:!1,endTime:0,totalMilliseconds:0,requestId:0}},computed:{days(){return Math.floor(this.totalMilliseconds/j)},hours(){return Math.floor(this.totalMilliseconds%j/E)},minutes(){return Math.floor(this.totalMilliseconds%E/$)},seconds(){return Math.floor(this.totalMilliseconds%$/S)},milliseconds(){return Math.floor(this.totalMilliseconds%S)},totalDays(){return this.days},totalHours(){return Math.floor(this.totalMilliseconds/E)},totalMinutes(){return Math.floor(this.totalMilliseconds/$)},totalSeconds(){return Math.floor(this.totalMilliseconds/S)}},watch:{$props:{deep:!0,immediate:!0,handler(){this.totalMilliseconds=this.time,this.endTime=this.now()+this.time,this.autoStart&&this.start()}}},mounted(){document.addEventListener(F,this.handleVisibilityChange)},beforeUnmount(){document.removeEventListener(F,this.handleVisibilityChange),this.pause()},methods:{start(){this.counting||(this.counting=!0,this.autoStart||(this.totalMilliseconds=this.time,this.endTime=this.now()+this.time),this.emitEvents&&this.$emit(A),document.visibilityState==="visible"&&this.continue())},continue(){if(!this.counting)return;const a=Math.min(this.totalMilliseconds,this.interval);if(a>0){let e,n;const x=u=>{e||(e=u),n||(n=u);const y=u-e;y>=a||y+(u-n)/2>=a?this.progress():this.requestId=requestAnimationFrame(x),n=u};this.requestId=requestAnimationFrame(x)}else this.end()},pause(){cancelAnimationFrame(this.requestId)},progress(){this.counting&&(this.update(),this.emitEvents&&this.totalMilliseconds>0&&this.$emit(H,{days:this.days,hours:this.hours,minutes:this.minutes,seconds:this.seconds,milliseconds:this.milliseconds,totalDays:this.totalDays,totalHours:this.totalHours,totalMinutes:this.totalMinutes,totalSeconds:this.totalSeconds,totalMilliseconds:this.totalMilliseconds}),this.continue())},abort(){this.counting&&(this.pause(),this.counting=!1,this.emitEvents&&this.$emit(O))},end(){this.counting&&(this.pause(),this.totalMilliseconds=0,this.counting=!1,this.emitEvents&&this.$emit(B))},update(){this.counting&&(this.totalMilliseconds=Math.max(0,this.endTime-this.now()))},restart(){this.pause(),this.totalMilliseconds=this.time,this.endTime=this.now()+this.time,this.counting=!1,this.start()},handleVisibilityChange(){switch(document.visibilityState){case"visible":this.update(),this.continue();break;case"hidden":this.pause();break}}},render(){return K(this.tag,this.$slots.default?[this.$slots.default(this.transform({days:this.days,hours:this.hours,minutes:this.minutes,seconds:this.seconds,milliseconds:this.milliseconds,totalDays:this.totalDays,totalHours:this.totalHours,totalMinutes:this.totalMinutes,totalSeconds:this.totalSeconds,totalMilliseconds:this.totalMilliseconds}))]:void 0)}});const ot={},rt={class:"text-gray-600 dark:text-slate-100 text-lg font-medium"},nt={class:"text-sm leading-normal text-gray-600 dark:text-slate-400 mt-1"};function lt(a,e){return f(),p("div",null,[t("h4",rt,[I(a.$slots,"title")]),t("p",nt,[I(a.$slots,"content")])])}const dt=at(ot,[["render",lt]]),ct={class:"relative flex-col md:flex-row flex items-start gap-4 mt-6"},ut={class:"md:w-1/2 lg:w-2/3"},ht=t("div",{class:"font-semibold text-xl mt-4 pt-2 border-t border-gray-100 dark:text-slate-200 dark:border-slate-500"}," Ваша поездка: ",-1),mt={class:"mt-3"},ft=t("div",{class:"text-sm font-medium dark:text-slate-400"},"Даты:",-1),_t={class:"dark:text-slate-200 font-medium"},vt={class:"mt-3"},gt=t("div",{class:"text-sm font-medium dark:text-slate-400"},"Гости:",-1),pt={class:"dark:text-slate-200 font-medium"},xt={key:0,class:"font-medium dark:text-slate-200"},yt=t("div",{class:"font-semibold text-xl mt-4 pt-2 border-t border-gray-100 dark:text-slate-200 dark:border-slate-500"}," Оплата: ",-1),bt={class:"flex items-baseline gap-5"},Mt=t("div",{class:"font-light text-sm text-neutral-800 leading-tight mt-4 dark:text-slate-400"},[c(" Сейчас вам необходимо оплатить только 30% от общей суммы, чтобы забронировать жилье. Оставшуюся сумму вы сможете перевести хозяину при заселении. "),t("br"),c("Таким образом, вы можете забронировать жилье заранее и не переживать о полной оплате до момента заселения. "),t("br"),c(" Оплата оставшейся суммы при заселении гарантирует вам получение жилья и удобство в расчетах. ")],-1),kt={class:"md:sticky w-full md:w-1/2 lg:w-1/3 top-14"},wt={class:"rounded-lg shadow-lg mt-6 border border-neutral-100 dark:border-slate-600 p-6"},St={class:"flex items-stretch justify-start gap-4"},$t=["src"],Et={class:"flex flex-col justify-between"},Dt={class:"text-gray-600 font-light dark:text-slate-300"},Tt=["innerHTML"],Nt=t("div",{class:"font-semibold text-xl mt-4 pt-2 border-t border-gray-100 dark:border-slate-600 dark:text-slate-200"}," Детализация цены: ",-1),It={class:"divide-y divide-gray-100 dark:divide-slate-600"},Lt={class:"py-2 flex w-full items-baseline justify-between"},Yt=t("dt",{class:"font-light leading-6 text-gray-600 dark:text-slate-300"},[t("div",null,"Гости:")],-1),Ct={class:"mt-1 font-medium leading-6 text-neutral-600 dark:text-slate-200"},Vt={key:0,class:"py-2 flex w-full items-baseline justify-between"},jt=t("dt",{class:"font-light leading-6 text-gray-600 dark:text-slate-300"},[t("div",null,"Дети:")],-1),Ot={class:"mt-1 font-medium leading-6 text-neutral-600 dark:text-slate-200"},Bt={class:"py-4 flex flex-col gap-2"},Ht={class:"flex w-full items-baseline justify-between"},At={class:"font-light leading-6 text-gray-600"},Ft={class:"font-light leading-none text-gray-600 dark:text-slate-300 outline-none border-b border-gray-400 dark:border-slate-300 hover:border-gray-600 transition"},Pt={class:"divide-y divide-gray-100 dark:divide-slate-600 max-h-52 overflow-auto"},qt={class:"font-light text-sm leading-6 text-gray-600 dark:text-slate-300"},Rt={class:"mt-1 text-sm font-medium leading-6 text-neutral-600 dark:text-slate-200"},Ut={class:"mt-1 font-medium leading-6 text-neutral-600 dark:text-slate-200"},Gt={class:"pt-4 flex w-full items-baseline justify-between"},zt=t("dt",{class:"font-bold leading-6 text-neutral-800 dark:text-slate-200"},[t("div",null,"Итого:")],-1),Jt={class:"mt-1 font-bold leading-6 text-neutral-800 dark:text-slate-200"},Kt={class:"text-sm leading-normal text-gray-600 dark:text-slate-400 mt-2"},Qt=["href"],me={__name:"Payment",props:{reservation:{type:Object}},setup(a){var T,N;const e=a,n=L([]);w(()=>{var v;m.extend(V);const i=m(e.reservation.data.start,"DD.MM.YYYY"),b=m(e.reservation.data.end,"DD.MM.YYYY");n.value=[];let _=0;for(let o=i;o.isBefore(b);o=o.add(1,"day")){const M=o.day()===5||o.day()===6?e.reservation.data.apartment.weekends_price:e.reservation.data.apartment.weekdays_price,g=((v=e.reservation.data.apartment.dates.find(k=>m(k.date).isSame(o)))==null?void 0:v.price)??M;n.value.push({date:o.format("DD.MM.YYYY"),price:g}),_+=g}return _});const x=w(()=>{let i=null;return(e.reservation.data.range<=1||e.reservation.data.range===21)&&(i=`${e.reservation.data.range} ночь`),(e.reservation.data.range>1&&e.reservation.data.range<=5||e.reservation.data.range>21&&e.reservation.data.range<=24)&&(i=`${e.reservation.data.range} ночи`),(e.reservation.data.range>5&&e.reservation.data.range<=20||e.reservation.data.range>24)&&(i=`${e.reservation.data.range} ночей`),`${i}`}),u=w(()=>[`${e.reservation.data.apartment.guests}&nbsp;гостей`,`${e.reservation.data.apartment.bedrooms}&nbsp;спальня`,`${e.reservation.data.apartment.beds}&nbsp;кровать`,`${e.reservation.data.apartment.bathrooms}&nbsp;ванная`].filter(b=>!!b).join(" · ")),y=()=>{tt.visit(route("account.reservations.pay",{reservation:e.reservation.data.id}))},P=L([{id:"account",route:route("account.index"),label:"Аккаунт"},{id:"reservations",route:route("account.reservations.list"),label:"Мои бронирования"},{id:"reservation",route:route("account.reservations.view",{reservation:(T=e.reservation.data)==null?void 0:T.id}),label:"Бронирование"},{id:"reservation.pay",route:route("account.reservations.view",{reservation:(N=e.reservation.data)==null?void 0:N.id}),label:"Оплата"}]),q=w(()=>{m.extend(V);const i=m(e.reservation.data.start,"DD.MM.YYYY").subtract(14,"days").hour(0);return m().isAfter(i)?"Отмена бронирования недоступна.":`Бесплатно до ${i.format("D MMMM")}. После - предоплату получит арендодатель.`});return(i,b)=>(f(),Q(R,null,{default:l(()=>[d(G,null,{default:l(()=>{var _,v,o,M,D,g,k;return[d(st,{routes:P.value},null,8,["routes"]),t("div",ct,[t("div",ut,[d(z,{title:"Оплата бронирования",subtitle:"Вы должны оплатить не позднее чем через пять часов, иначе бронирование отменится."}),t("div",null,[ht,t("div",mt,[ft,t("div",_t,s(e.reservation.data.start)+" - "+s(e.reservation.data.end),1)]),t("div",vt,[gt,t("div",pt,s(e.reservation.data.guests)+" гостя",1),e.reservation.data.children?(f(),p("div",xt,s(e.reservation.data.children)+" детей ",1)):Y("",!0)])]),t("div",null,[yt,t("div",bt,[d(et,{class:"mt-3 px-16","auto-width":!0,label:`Перейти к оплате: ${(_=e.reservation.data.first_payment)==null?void 0:_.toLocaleString()}₽`,onClick:y},null,8,["label"]),d(C(it),{class:"text-neutral-800 dark:text-slate-400 font-medium text-lg",time:e.reservation.data.remaining},{default:l(({hours:r,minutes:h})=>[c(" Осталось "+s(r)+" ч. "+s(h)+" мин. ",1)]),_:1},8,["time"])]),Mt])]),t("div",kt,[t("div",wt,[t("div",St,[d(C(W),{href:i.route("apartment",{apartment:(v=e.reservation.data.apartment)==null?void 0:v.id}),class:"h-24 w-32 rounded-lg overflow-hidden"},{default:l(()=>{var r,h;return[t("img",{src:(h=(r=e.reservation.data.apartment)==null?void 0:r.media[0])==null?void 0:h.src,class:"h-full w-full object-cover",alt:""},null,8,$t)]}),_:1},8,["href"]),t("div",Et,[t("div",Dt,s((D=(M=(o=e.reservation.data)==null?void 0:o.apartment)==null?void 0:M.category)==null?void 0:D.title),1),t("div",{class:"font-light text-xs text-gray-600 mt-1 dark:text-slate-300",innerHTML:u.value},null,8,Tt)])]),Nt,t("dl",It,[t("div",Lt,[Yt,t("dd",Ct,s(e.reservation.data.guests),1)]),e.reservation.data.children>0?(f(),p("div",Vt,[jt,t("dd",Ot,s(e.reservation.data.children),1)])):Y("",!0),t("div",Bt,[t("div",Ht,[t("dt",At,[d(U,null,{toggle:l(()=>[t("div",Ft,s(x.value),1)]),content:l(()=>[t("dl",Pt,[(f(!0),p(Z,null,X(n.value,r=>{var h;return f(),p("div",{class:"py-1 px-4 flex w-full items-baseline justify-between",key:r.date},[t("dt",qt,s(r.date),1),t("dd",Rt,s((h=r.price)==null?void 0:h.toLocaleString())+"₽ ",1)])}),128))])]),_:1})]),t("dd",Ut,s((g=e.reservation.data.price)==null?void 0:g.toLocaleString())+"₽ ",1)])]),t("div",Gt,[zt,t("dd",Jt,s((k=e.reservation.data.price)==null?void 0:k.toLocaleString())+"₽ ",1)])])]),d(dt,{class:"mt-4"},{title:l(()=>[c("Отмена брони:")]),content:l(()=>[c(s(q.value),1)]),_:1}),t("p",Kt,[c(" При переходе к оплате вы соглашаетесь на "),t("a",{class:"underline hover:text-gray-500 dark:hover:text-slate-300",href:i.route("policy")},"обработку персональных данных",8,Qt),c(" и передачу персональных данных арендодателю ")])])])]}),_:1})]),_:1}))}};export{me as default};
