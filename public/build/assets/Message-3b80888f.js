import{_ as b}from"./ButtonComponent-f4827ed1.js";import{_ as O}from"./index-8e0b7414.js";import{_ as N}from"./Input-68e106d5.js";import{r as y,j as L,k as S,a as r,c as u,g as e,t as a,n as q,i as g,f as v,F as C,e as m,m as A,w as R,u as w,O as E}from"./app-74e2d235.js";import{u as F}from"./useToasts-1b79cb61.js";import{_ as P}from"./Avatar-1b46dd9e.js";const z=e("div",{class:"font-semibold text-neutral-800 dark:text-slate-200"},"Запрос на бронирование",-1),D={class:"font-light text-xs text-gray-400"},U={class:"font-light text-neutral-800 dark:text-white"},G={class:"text-neutral-400 text-sm"},H={class:"font-light text-neutral-800 dark:text-slate-200"},I={key:0},J={key:0},K={class:"flex justify-end gap-2"},Q={key:1,class:"font-light text-neutral-800"},W={class:"divide-y divide-gray-100"},X={class:"py-2 flex w-full items-baseline justify-between"},Y=e("dt",{class:"font-light leading-6 text-пкфн-600"},[e("div",null,"Даты:")],-1),Z={class:"mt-1 font-medium leading-6 text-neutral-600"},ee={class:"text-neutral-400 text-sm"},te={class:"py-2 flex w-full items-baseline justify-between"},se=e("dt",{class:"font-light leading-6 text-пкфн-600"},[e("div",null,"Взрослые:")],-1),ae={class:"mt-1 font-medium leading-6 text-neutral-600"},le={key:0,class:"py-2 flex w-full items-baseline justify-between"},oe=e("dt",{class:"font-light leading-6 text-пкфн-600"},[e("div",null,"Дети:")],-1),ne={class:"mt-1 font-medium leading-6 text-neutral-600"},ie={class:"py-2 flex w-full items-baseline justify-between"},re={class:"font-light leading-6 text-пкфн-600"},ue={class:"mt-1 font-medium leading-6 text-neutral-600"},de={class:"py-2 flex w-full items-baseline justify-between"},ce=e("dt",{class:"font-light leading-6 text-пкфн-600"},[e("div",null,"Сервисный сбор:")],-1),ve={class:"mt-1 font-medium leading-6 text-neutral-600"},_e={class:"py-2 flex w-full items-baseline justify-between"},me=e("dt",{class:"font-bold leading-6 text-neutral-800"},[e("div",null,"Итого:")],-1),fe={class:"mt-1 font-bold leading-6 text-neutral-800"},qe={__name:"ReservationRequest",props:{item:{required:!0},compact:{type:Boolean,default:!1},isOwner:{type:Boolean,default:!1}},setup(h){const n=h,t=y(n.item),_=y(!1),d=y(!1),c=L({status_text:""}),{infoToast:f,successToast:p,errorToast:x}=F(),T=()=>{axios.post(route("account.reservation-requests.reject",{reservationRequest:t.value.id}),{status_text:c.status_text}).then(l=>{var s,o;_.value=!1,t.value.status=(s=l.data)==null?void 0:s.status,t.value.status_text=(o=l.data)==null?void 0:o.status_text,f("Отказано в запросе на бронирование.")}).catch(l=>{var s,o,i,$,j;((s=l.response)==null?void 0:s.status)===422&&(console.log("error.response?.data?.message",(i=(o=l.response)==null?void 0:o.data)==null?void 0:i.message),c.setError("status_text",((j=($=l.response)==null?void 0:$.data)==null?void 0:j.message)??"Что-то пошло не так."))})},V=()=>{axios.post(route("account.reservation-requests.submit",{reservationRequest:t.value.id})).then(l=>{var s,o;d.value=!1,t.value.status=(s=l.data)==null?void 0:s.status,t.value.reservation_id=(o=l.data)==null?void 0:o.reservation_id,p("Создано новое бронирование. Ожидайте оплату.")}).catch(l=>{x("Что-то пошло не так.")})},B=()=>{var l,s;if((l=t.value.reservation)!=null&&l.id){const o=n.isOwner?"account.reservations.owner.view":"account.reservations.view";E.visit(route(o,{reservation:(s=t.value.reservation)==null?void 0:s.id}))}},k=S(()=>Math.ceil(t.value.price*.18)),M=S(()=>t.value.price+k.value);return(l,s)=>{var o;return r(),u("div",{class:q(["border border-gray-300 dark:border-slate-700 rounded-lg p-3",[t.value.status==="rejected"?"opacity-40":"",t.value.status==="submitted"?"border-teal-600":""]])},[e("div",{class:q(["flex items-baseline justify-between",n.compact?"flex-col-reverse gap-0":"gap-4"])},[z,e("div",D,a(t.value.created_at),1)],2),e("div",U,[g(" с "+a(t.value.start)+" по "+a(t.value.end)+" | ",1),e("span",G,"ночи: "+a(t.value.range),1)]),e("div",H,[g(" Взрослые: "+a(t.value.guests)+" ",1),t.value.children>0?(r(),u("span",I," | Дети: "+a(t.value.children),1)):v("",!0)]),n.compact?v("",!0):(r(),u("div",J,[e("div",K,[n.isOwner?(r(),u(C,{key:0},[t.value.status?v("",!0):(r(),u(C,{key:0},[m(b,{label:"Отказать",onClick:s[0]||(s[0]=i=>_.value=!0),small:!0,outline:!0,"auto-width":!0,class:"px-3"}),m(b,{label:"Подтвердить",onClick:s[1]||(s[1]=i=>d.value=!0),small:!0,"bg-class":"bg-green-50","text-class":"text-green-800","border-class":"border-green-800","auto-width":!0,class:"px-3"})],64))],64)):v("",!0),t.value.status==="submitted"&&((o=t.value.reservation)!=null&&o.id)?(r(),A(b,{key:1,label:"К бронированию",small:!0,outline:!0,"auto-width":!0,onClick:B,class:"px-3"})):v("",!0)])])),t.value.status==="rejected"?(r(),u("div",Q,a(`Отказано${t.value.status_text?": "+t.value.status_text:""}`),1)):v("",!0),m(O,{"is-open":_.value,onOnSecondaryAction:s[3]||(s[3]=i=>_.value=!1),onOnClose:s[4]||(s[4]=i=>_.value=!1),onOnSubmit:T,title:"Отказать в запросе на бронирование","action-label":"Отказать","secondary-action-label":"Отменить"},{body:R(()=>[m(N,{modelValue:w(c).status_text,"onUpdate:modelValue":s[2]||(s[2]=i=>w(c).status_text=i),id:"reason",name:"reason",error:w(c).errors.status_text,label:"Укажите причину отказа (можно не указывать)"},null,8,["modelValue","error"])]),_:1},8,["is-open"]),m(O,{"is-open":d.value,onOnSecondaryAction:s[5]||(s[5]=i=>d.value=!1),onOnClose:s[6]||(s[6]=i=>d.value=!1),onOnSubmit:V,title:"Подтвердить запрос на бронирование","action-label":"Подтвердить","secondary-action-label":"Отменить"},{body:R(()=>[e("dl",W,[e("div",X,[Y,e("dd",Z,[g(" с "+a(t.value.start)+" по "+a(t.value.end)+" | ",1),e("span",ee,"ночи: "+a(t.value.range),1)])]),e("div",te,[se,e("dd",ae,a(t.value.guests),1)]),t.value.children>0?(r(),u("div",le,[oe,e("dd",ne,a(t.value.children),1)])):v("",!0),e("div",ie,[e("dt",re,[e("div",null,a(t.value.range)+" ночи:",1)]),e("dd",ue,a(t.value.price.toLocaleString())+"₽ ",1)]),e("div",de,[ce,e("dd",ve,a(k.value.toLocaleString())+"₽ ",1)]),e("div",_e,[me,e("dd",fe,a(M.value.toLocaleString())+"₽",1)])])]),_:1},8,["is-open"])],2)}}},pe={class:"flex items-start gap-2"},xe={class:"flex flex-col"},ge={class:"text-sm font-bold"},he={key:0,class:"text-neutral-600"},be={class:"font-light text-xs text-gray-400"},ye={class:""},Ce={__name:"Message",props:{item:{type:Object,required:!0}},setup(h){const n=h;return(t,_)=>{var d,c,f,p,x;return r(),u("div",pe,[m(P,{src:(d=n.item.user)==null?void 0:d.avatar},null,8,["src"]),e("div",xe,[e("div",ge,[((f=(c=t.$page.props.user)==null?void 0:c.data)==null?void 0:f.id)===((p=n.item.user)==null?void 0:p.id)?(r(),u("span",he,"Вы:")):v("",!0),g(" "+a((x=n.item.user)==null?void 0:x.name)+" ",1),e("span",be,a(n.item.created_at),1)]),e("div",ye,a(n.item.message),1)])])}}};export{qe as _,Ce as a};
