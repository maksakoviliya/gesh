import{_ as O}from"./ButtonComponent-8f06ca62.js";import{_ as L}from"./index-a54f5213.js";import{_ as K}from"./Input-3776f385.js";import{r as S,p as D,q as T,a as o,c as n,g as t,t as a,n as j,i as p,f as d,F as f,e as _,l as G,w as E,u as V,O as U,Y,G as H}from"./app-c24ead7a.js";import{u as J}from"./useToasts-2c5e9728.js";import{_ as Q}from"./Avatar-bd83dee3.js";const W=t("div",{class:"font-semibold text-neutral-800 dark:text-slate-200"},"Запрос на бронирование",-1),X={class:"font-light text-xs text-gray-400"},Z={class:"font-light text-neutral-800 dark:text-white"},ee={class:"text-neutral-400 text-sm"},te={class:"font-light text-neutral-800 dark:text-slate-200"},se={key:0},ae={class:"flex items-center gap-2 flex-wrap"},le={class:"font-light text-neutral-800 dark:text-slate-200"},oe=t("span",{class:"dark:text-slate-300"},"|",-1),re={class:"font-light text-neutral-800 dark:text-slate-200"},ne={key:0,class:"text-sm font-light text-right text-gray-500 dark:text-slate-400 mt-2"},ie={key:1,class:"text-sm font-light text-right text-gray-500 dark:text-slate-400 mt-2"},de={key:2,class:"text-sm font-light text-right text-emerald-500 dark:text-teal-400 mt-2"},ue={key:0,class:"flex justify-end gap-2 mt-3"},ce={id:"copy_payment_link",role:"tooltip",class:"absolute z-20 break-words whitespace-nowrap invisible inline-block px-3 py-2 text-xs font-medium text-white transition-opacity duration-300 bg-gray-900 rounded-lg shadow-sm opacity-0 tooltip dark:bg-gray-700"},ve=t("div",{class:"tooltip-arrow","data-popper-arrow":""},null,-1),me={key:4,class:"font-light text-neutral-800"},xe=t("div",{class:"text-neutral-400 text-sm mt-1"},"Если укажете - то гость будет видеть причину отказа.",-1),pe={class:"divide-y divide-gray-100"},_e={class:"py-2 flex w-full items-baseline justify-between"},fe=t("dt",{class:"font-light leading-6 text-gray-600 dark:text-slate-300"},[t("div",null,"Даты:")],-1),ge={class:"mt-1 font-medium leading-6 text-neutral-600 dark:text-slate-200"},he={class:"text-neutral-400 text-sm"},be={class:"py-2 flex w-full items-baseline justify-between"},ye=t("dt",{class:"font-light leading-6 text-gray-600 dark:text-slate-300"},[t("div",null,"Взрослые:")],-1),ke={class:"mt-1 font-medium leading-6 text-neutral-600 dark:text-slate-200"},we={key:0,class:"py-2 flex w-full items-baseline justify-between"},$e=t("dt",{class:"font-light leading-6 text-gray-600 dark:text-slate-300"},[t("div",null,"Дети:")],-1),Oe={class:"mt-1 font-medium leading-6 text-neutral-600 dark:text-slate-200"},Se={class:"py-2 flex w-full items-baseline justify-between"},je={class:"font-light leading-6 text-gray-600 dark:text-slate-300"},Ce={class:"mt-1 font-medium leading-6 text-neutral-600 dark:text-slate-200"},Te={class:"py-2 flex w-full items-baseline justify-between"},Ve=t("dt",{class:"font-light leading-6 text-gray-600 dark:text-slate-300"},[t("div",null,"Первоначальный платеж:")],-1),qe={class:"mt-1 font-medium leading-6 text-neutral-600 dark:text-slate-200"},Ye={__name:"ReservationRequest",props:{item:{required:!0},compact:{type:Boolean,default:!1},isOwner:{type:Boolean,default:!1}},setup(i){const r=i,e=S(r.item),m=S(!1),u=S(!1),v=D({status_text:""}),{infoToast:y,successToast:k,errorToast:w}=J(),N=()=>{axios.post(route("account.reservation-requests.reject",{reservationRequest:e.value.id}),{status_text:v.status_text}).then(l=>{var s,c;m.value=!1,e.value.status=(s=l.data)==null?void 0:s.status,e.value.status_text=(c=l.data)==null?void 0:c.status_text,y("Отказано в запросе на бронирование.")}).catch(l=>{var s,c,g,h,b;((s=l.response)==null?void 0:s.status)===422&&(console.log("error.response?.data?.message",(g=(c=l.response)==null?void 0:c.data)==null?void 0:g.message),v.setError("status_text",((b=(h=l.response)==null?void 0:h.data)==null?void 0:b.message)??"Что-то пошло не так."))})},P=()=>{axios.post(route("account.reservation-requests.submit",{reservationRequest:e.value.id})).then(l=>{var s,c;u.value=!1,e.value.status=(s=l.data)==null?void 0:s.status,e.value.reservation_id=(c=l.data)==null?void 0:c.reservation_id,k("Создано новое бронирование. Ожидайте оплату.")}).catch(l=>{w("Что-то пошло не так.")})},A=()=>{var l,s;if((l=e.value.reservation)!=null&&l.id){const c=r.isOwner?"account.reservations.owner.view":"account.reservations.view";U.visit(route(c,{reservation:(s=e.value.reservation)==null?void 0:s.id}))}},$=S("Копировать ссылку на оплату"),F=()=>{var l;$.value="Скопировано",navigator.clipboard.writeText(route("account.reservations.pay",{reservation:(l=e.value.reservation)==null?void 0:l.id})).then(()=>{$.value="Скопировано",setTimeout(()=>{$.value="Копировать ссылку на оплату"},1500)})},I=T(()=>{const l=(e.value.price>=1e5,.15);return Math.ceil(e.value.price*l)}),C=T(()=>e.value.price+I.value),q=T(()=>Math.ceil(C.value*.3));return(l,s)=>{var c,g,h,b,B,R,M,z;return o(),n("div",{class:j(["border border-gray-300 dark:border-slate-700 rounded-lg p-3",[e.value.status==="rejected"?"opacity-40":"",e.value.status==="submitted"?"border-teal-600":""]])},[t("div",{class:j(["flex items-baseline justify-between",r.compact?"flex-col-reverse gap-0":"gap-4"])},[W,t("div",X,a(e.value.created_at),1)],2),t("div",Z,[p(" с "+a(e.value.start)+" по "+a(e.value.end)+" | ",1),t("span",ee,"ночи: "+a(e.value.range),1)]),t("div",te,[p(" Взрослые: "+a(e.value.guests)+" ",1),e.value.children>0?(o(),n("span",se," | Дети: "+a(e.value.children),1)):d("",!0)]),t("div",ae,[t("div",le,"Цена: "+a(C.value.toLocaleString())+"₽",1),oe,t("div",re," Первоначальный платеж: "+a(q.value.toLocaleString())+"₽ ",1)]),e.value.status==="pending"&&!r.isOwner&&!r.compact?(o(),n("div",ne," Ожидаем решение собственника ")):d("",!0),e.value.status==="submitted"&&!r.compact&&(!((c=e.value.reservation)!=null&&c.id)||((g=e.value.reservation)==null?void 0:g.status)!=="paid")?(o(),n("div",ie,[((h=e.value.reservation)==null?void 0:h.status)==="payment_waiting"?(o(),n(f,{key:0},[p(" Ожидаем одобрение платежа ")],64)):(o(),n(f,{key:1},[p(" Ожидаем оплату ")],64))])):d("",!0),e.value.status==="submitted"&&((b=e.value.reservation)!=null&&b.id)&&((B=e.value.reservation)==null?void 0:B.status)==="paid"?(o(),n("div",de," Оплачен ")):d("",!0),r.compact?d("",!0):(o(),n(f,{key:3},[r.isOwner||e.value.status==="submitted"&&((R=e.value.reservation)!=null&&R.id)?(o(),n("div",ue,[r.isOwner?(o(),n(f,{key:0},[e.value.status==="pending"?(o(),n(f,{key:0},[_(O,{label:"Отказать",onClick:s[0]||(s[0]=x=>m.value=!0),small:!0,outline:!0,"auto-width":!0,class:"px-3"}),_(O,{label:"Подтвердить",onClick:s[1]||(s[1]=x=>u.value=!0),small:!0,"bg-class":"bg-green-50","text-class":"text-green-800","border-class":"border-green-800","auto-width":!0,class:"px-3"})],64)):d("",!0)],64)):d("",!0),e.value.status==="submitted"&&((M=e.value.reservation)!=null&&M.id)?(o(),n(f,{key:1},[r.isOwner&&((z=e.value.reservation)==null?void 0:z.status)!=="paid"?(o(),G(O,{key:0,label:"Ссылка на оплату",small:!0,outline:!0,"auto-width":!0,"data-tooltip-target":"copy_payment_link",onClick:F,class:"px-3"})):d("",!0),t("div",ce,[p(a($.value)+" ",1),ve]),_(O,{label:"К бронированию",small:!0,outline:!0,"auto-width":!0,onClick:A,class:"px-3"})],64)):d("",!0)])):d("",!0)],64)),e.value.status==="rejected"?(o(),n("div",me,a(`Отказано${e.value.status_text?": "+e.value.status_text:""}`),1)):d("",!0),_(L,{"is-open":m.value,onOnSecondaryAction:s[3]||(s[3]=x=>m.value=!1),onOnClose:s[4]||(s[4]=x=>m.value=!1),onOnSubmit:N,title:"Отказать в запросе на бронирование","action-label":"Отказать","secondary-action-label":"Отменить"},{body:E(()=>[_(K,{modelValue:V(v).status_text,"onUpdate:modelValue":s[2]||(s[2]=x=>V(v).status_text=x),id:"reason",name:"reason",error:V(v).errors.status_text,label:"Укажите причину отказа (можно не указывать)"},null,8,["modelValue","error"]),xe]),_:1},8,["is-open"]),_(L,{"is-open":u.value,onOnSecondaryAction:s[5]||(s[5]=x=>u.value=!1),onOnClose:s[6]||(s[6]=x=>u.value=!1),onOnSubmit:P,title:"Подтвердить запрос на бронирование","action-label":"Подтвердить","secondary-action-label":"Отменить"},{body:E(()=>[t("dl",pe,[t("div",_e,[fe,t("dd",ge,[p(" с "+a(e.value.start)+" по "+a(e.value.end)+" | ",1),t("span",he,"ночи: "+a(e.value.range),1)])]),t("div",be,[ye,t("dd",ke,a(e.value.guests),1)]),e.value.children>0?(o(),n("div",we,[$e,t("dd",Oe,a(e.value.children),1)])):d("",!0),t("div",Se,[t("dt",je,[t("div",null,a(e.value.range)+" ночи:",1)]),t("dd",Ce,a(C.value.toLocaleString())+"₽ ",1)]),t("div",Te,[Ve,t("dd",qe,a(q.value.toLocaleString())+"₽ ",1)])])]),_:1},8,["is-open"])],2)}}},Be={class:"flex items-start gap-2"},Re={class:"flex flex-col"},Me={class:"text-sm font-bold"},ze={key:0,class:"text-neutral-600"},Le={class:"font-light text-xs text-gray-400"},Ee={class:""},He={__name:"Message",props:{item:{type:Object,required:!0}},setup(i){const r=i;return(e,m)=>{var u,v,y,k,w;return o(),n("div",Be,[_(Q,{src:(u=r.item.user)==null?void 0:u.avatar},null,8,["src"]),t("div",Re,[t("div",Me,[((y=(v=e.$page.props.user)==null?void 0:v.data)==null?void 0:y.id)===((k=r.item.user)==null?void 0:k.id)?(o(),n("span",ze,"Вы:")):d("",!0),p(" "+a((w=r.item.user)==null?void 0:w.name)+" ",1),t("span",Le,a(r.item.created_at),1)]),t("div",Ee,a(r.item.message),1)])])}}},Ne={class:"w-full relative",autocomplete:"off"},Pe=["id","disabled","value"],Ae={key:0,class:"text-rose-500 text-sm font-light"},Je={__name:"TextareaInput",props:{id:String,label:String,type:String|null,error:String|null,disabled:Boolean|null,required:Boolean|null,modelValue:String,textareaClass:String|null},emits:["onEnter","update:modelValue"],setup(i,{emit:r}){const e=r;return(m,u)=>(o(),n("form",Ne,[t("textarea",{id:i.id,disabled:i.disabled,placeholder:" ",value:i.modelValue,onInput:u[0]||(u[0]=v=>m.$emit("update:modelValue",v.target.value)),onKeydown:u[1]||(u[1]=Y(H(v=>e("onEnter"),["prevent"]),["enter"])),autocomplete:"new-password",class:j(["peer w-full p-4 pt-6 font-light bg-white dark:bg-slate-800 border-2 dark:text-white rounded-md shadow-none outline-none transition disabled:opacity-70 focus:ring-0 resize-none pl-4 disabled:cursor-not-allowed",`
                    ${i.error?"border-rose-500":"border-neutral-300 dark:border-slate-700"}
                ${i.error?"focus:border-rose-500":"focus:border-black dark:border-slate-700"}
                ${i.textareaClass}
            `])},null,42,Pe),t("label",{class:j(["absolute text-md duration-150 transform -translate-y-3 scale-75 top-5 left-4 z-10 origin-[0] peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-4",i.error?"text-rose-500":"text-zinc-400"])},a(i.label),3),i.error?(o(),n("div",Ae,a(i.error),1)):d("",!0)]))}};export{Je as _,Ye as a,He as b};
